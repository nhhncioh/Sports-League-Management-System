{% extends "base.html" %}
{% block title %}Manage Venues{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="h3 mb-1">Manage Venues</h1>
            <p class="text-muted mb-0">Add and manage sports venues, stadiums, and facilities</p>
        </div>
        <a href="{{ url_for('admin.admin_dashboard') }}" class="btn btn-outline-secondary">
            <i class="ph ph-arrow-left me-1"></i> Back to Admin
        </a>
    </div>

    <div class="row">
        <!-- Venue Form -->
        <div class="col-lg-5">
            <div class="card border-0 shadow-sm sticky-top" style="top: 20px;">
                <div class="card-header bg-white border-0">
                    <h2 class="h5 mb-0" id="form-title">
                        <i class="ph ph-plus-circle me-2"></i>Add New Venue
                    </h2>
                </div>
                <div class="card-body">
                    <form action="{{ url_for('admin.manage_venues') }}" method="POST" id="venueForm">
                        <input type="hidden" id="venue_id" name="venue_id">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

                        <!-- Basic Information -->
                        <div class="mb-4">
                            <h6 class="text-muted text-uppercase small fw-bold mb-3">Basic Information</h6>

                            <div class="mb-3">
                                <label for="name" class="form-label">Venue Name <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="name" name="name" required placeholder="e.g., Madison Square Garden">
                            </div>

                            <div class="mb-3">
                                <label for="location" class="form-label">Location/Area <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="location" name="location" required placeholder="e.g., Manhattan, New York">
                                <div class="form-text">General area or neighborhood</div>
                            </div>

                            <div class="mb-3">
                                <label for="capacity" class="form-label">Capacity</label>
                                <input type="number" class="form-control" id="capacity" name="capacity" placeholder="e.g., 20000">
                            </div>
                        </div>

                        <!-- Address Details -->
                        <div class="mb-4">
                            <h6 class="text-muted text-uppercase small fw-bold mb-3">Address</h6>

                            <div class="mb-3">
                                <label for="address" class="form-label">Street Address</label>
                                <input type="text" class="form-control" id="address" name="address" placeholder="e.g., 4 Pennsylvania Plaza">
                            </div>

                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="city" class="form-label">City</label>
                                    <input type="text" class="form-control" id="city" name="city" placeholder="e.g., New York">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="state" class="form-label">State/Province</label>
                                    <input type="text" class="form-control" id="state" name="state" placeholder="e.g., NY">
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="zip_code" class="form-label">ZIP/Postal Code</label>
                                    <input type="text" class="form-control" id="zip_code" name="zip_code" placeholder="e.g., 10001">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="country" class="form-label">Country</label>
                                    <input type="text" class="form-control" id="country" name="country" value="USA" placeholder="e.g., USA">
                                </div>
                            </div>
                        </div>

                        <!-- Contact & Web -->
                        <div class="mb-4">
                            <h6 class="text-muted text-uppercase small fw-bold mb-3">Contact & Web</h6>

                            <div class="mb-3">
                                <label for="phone" class="form-label">Phone Number</label>
                                <input type="tel" class="form-control" id="phone" name="phone" placeholder="e.g., (212) 465-6741">
                            </div>

                            <div class="mb-3">
                                <label for="website" class="form-label">Website</label>
                                <input type="url" class="form-control" id="website" name="website" placeholder="https://example.com">
                            </div>
                        </div>

                        <!-- Description & Amenities -->
                        <div class="mb-4">
                            <h6 class="text-muted text-uppercase small fw-bold mb-3">Additional Details</h6>

                            <div class="mb-3">
                                <label for="description" class="form-label">Description</label>
                                <textarea class="form-control" id="description" name="description" rows="3" placeholder="Brief description of the venue..."></textarea>
                            </div>

                            <div class="mb-3">
                                <label for="amenities" class="form-label">Amenities</label>
                                <textarea class="form-control" id="amenities" name="amenities" rows="2" placeholder="e.g., Parking, Concessions, WiFi, Locker Rooms"></textarea>
                                <div class="form-text">Comma-separated list of available amenities</div>
                            </div>
                        </div>

                        <div class="d-flex gap-2">
                            <button type="submit" name="add" class="btn btn-primary flex-grow-1" id="submit-button">
                                <i class="ph ph-plus-circle me-1"></i>Add Venue
                            </button>
                            <button type="button" class="btn btn-outline-secondary" id="cancel-edit-btn" style="display: none;" onclick="resetForm()">
                                Cancel
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Venues List -->
        <div class="col-lg-7">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white border-0">
                    <h2 class="h5 mb-0">
                        <i class="ph ph-map-trifold me-2"></i>All Venues ({{ venues|length }})
                    </h2>
                </div>
                <div class="card-body p-0">
                    {% if venues %}
                        <div class="table-responsive">
                            <table class="table table-hover align-middle mb-0">
                                <thead class="table-light">
                                    <tr>
                                        <th>Venue</th>
                                        <th>Location</th>
                                        <th class="text-center">Capacity</th>
                                        <th class="text-end">Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for venue in venues %}
                                    <tr>
                                        <td>
                                            <div class="fw-bold">{{ venue[1] }}</div>
                                            {% if venue[11] %}
                                                <small class="text-muted">{{ venue[11][:60] }}{% if venue[11]|length > 60 %}...{% endif %}</small>
                                            {% endif %}
                                        </td>
                                        <td>
                                            <div>{{ venue[2] }}</div>
                                            {% if venue[4] %}
                                                <small class="text-muted">{{ venue[4] }}{% if venue[5] %}, {{ venue[5] }}{% endif %}</small>
                                            {% endif %}
                                        </td>
                                        <td class="text-center">
                                            {% if venue[8] %}
                                                <span class="badge bg-light text-dark">{{ "{:,}".format(venue[8]) }}</span>
                                            {% else %}
                                                <span class="text-muted">-</span>
                                            {% endif %}
                                        </td>
                                        <td class="text-end">
                                            <div class="btn-group btn-group-sm">
                                                <button class="btn btn-outline-success" onclick='editVenue({{ venue|tojson }})' title="Edit">
                                                    <i class="ph ph-pencil"></i>
                                                </button>
                                                <button class="btn btn-outline-danger" data-bs-toggle="modal" data-bs-target="#deleteModal" data-id="{{ venue[0] }}" title="Delete">
                                                    <i class="ph ph-trash"></i>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% else %}
                        <div class="text-center py-5">
                            <i class="ph ph-map-trifold" style="font-size: 3rem; opacity: 0.3;"></i>
                            <p class="text-muted mt-3 mb-0">No venues yet. Add your first venue to get started.</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <form method="POST" action="{{ url_for('admin.manage_venues') }}">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <input type="hidden" id="deleteItemId" name="venue_id">
                <div class="modal-header">
                    <h5 class="modal-title">Confirm Delete</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to delete this venue?</p>
                    <p class="text-danger"><i class="ph ph-warning me-1"></i>This action cannot be undone.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" name="delete" class="btn btn-danger">Delete Venue</button>
                </div>
            </form>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
function editVenue(venue) {
    // venue is an array: [id, name, location, address, city, state, zip, country, capacity, phone, website, description, lat, lng, amenities]
    document.getElementById('venue_id').value = venue[0];
    document.getElementById('name').value = venue[1] || '';
    document.getElementById('location').value = venue[2] || '';
    document.getElementById('address').value = venue[3] || '';
    document.getElementById('city').value = venue[4] || '';
    document.getElementById('state').value = venue[5] || '';
    document.getElementById('zip_code').value = venue[6] || '';
    document.getElementById('country').value = venue[7] || 'USA';
    document.getElementById('capacity').value = venue[8] || '';
    document.getElementById('phone').value = venue[9] || '';
    document.getElementById('website').value = venue[10] || '';
    document.getElementById('description').value = venue[11] || '';
    document.getElementById('amenities').value = venue[14] || '';

    document.getElementById('submit-button').innerHTML = '<i class="ph ph-check-circle me-1"></i>Update Venue';
    document.getElementById('submit-button').name = 'edit';
    document.getElementById('form-title').innerHTML = '<i class="ph ph-pencil me-2"></i>Edit Venue';
    document.getElementById('cancel-edit-btn').style.display = 'block';

    // Scroll to form
    document.getElementById('venueForm').scrollIntoView({ behavior: 'smooth', block: 'start' });
}

function resetForm() {
    document.getElementById('venueForm').reset();
    document.getElementById('venue_id').value = '';
    document.getElementById('country').value = 'USA';
    document.getElementById('submit-button').innerHTML = '<i class="ph ph-plus-circle me-1"></i>Add Venue';
    document.getElementById('submit-button').name = 'add';
    document.getElementById('form-title').innerHTML = '<i class="ph ph-plus-circle me-2"></i>Add New Venue';
    document.getElementById('cancel-edit-btn').style.display = 'none';
}

// Delete modal handler
document.getElementById('deleteModal').addEventListener('show.bs.modal', function (event) {
    const button = event.relatedTarget;
    const id = button.getAttribute('data-id');
    document.getElementById('deleteItemId').value = id;
});
</script>
{% endblock %}
