{% extends "base.html" %}
{% block title %}Recovery Codes - Sports League Management{% endblock %}
{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="alert alert-success">
            <h4><i class="ph ph-check-circle"></i> Two-Factor Authentication Enabled!</h4>
            <p class="mb-0">Your account is now protected with two-factor authentication.</p>
        </div>

        <div class="card mb-4">
            <div class="card-body">
                <h5 class="card-title">
                    <i class="ph ph-key"></i> Backup Recovery Codes
                </h5>
                <p class="text-danger">
                    <strong>Important:</strong> Save these recovery codes in a safe place.
                    Each code can only be used once if you lose access to your authenticator app.
                </p>

                <div class="row">
                    {% for code in recovery_codes %}
                    <div class="col-md-6 mb-2">
                        <div class="alert alert-light text-center" style="font-family: monospace; font-size: 1.2rem;">
                            {{ code }}
                        </div>
                    </div>
                    {% endfor %}
                </div>

                <div class="d-flex gap-2 mt-3">
                    <button class="btn btn-secondary" onclick="printCodes()">
                        <i class="ph ph-printer"></i> Print Codes
                    </button>
                    <button class="btn btn-secondary" onclick="copyCodes()">
                        <i class="ph ph-copy"></i> Copy to Clipboard
                    </button>
                    <button class="btn btn-secondary" onclick="downloadCodes()">
                        <i class="ph ph-download"></i> Download as Text
                    </button>
                </div>
            </div>
        </div>

        <div class="alert alert-warning">
            <i class="ph ph-warning"></i>
            <strong>Security Tips:</strong>
            <ul class="mb-0 mt-2">
                <li>Store these codes in a password manager or secure location</li>
                <li>Do not share these codes with anyone</li>
                <li>Each code can only be used once</li>
                <li>If you use all codes, you can generate new ones from your account settings</li>
            </ul>
        </div>

        <div class="text-center">
            <a href="{{ url_for('public.home', org=session.get('org_slug')) }}" class="btn btn-primary">
                Continue to Dashboard
            </a>
        </div>
    </div>
</div>

<script>
const codes = {{ recovery_codes | tojson }};

function printCodes() {
    window.print();
}

function copyCodes() {
    const text = codes.join('\n');
    navigator.clipboard.writeText(text).then(() => {
        alert('Recovery codes copied to clipboard!');
    });
}

function downloadCodes() {
    const text = 'Two-Factor Authentication Recovery Codes\n' +
                 'Save these codes in a secure location.\n\n' +
                 codes.join('\n') +
                 '\n\nEach code can only be used once.';
    const blob = new Blob([text], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'recovery-codes.txt';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
}
</script>

<style>
@media print {
    .btn, .alert-warning, nav, footer { display: none !important; }
    .card { border: 2px solid #000; }
}
</style>
{% endblock %}
