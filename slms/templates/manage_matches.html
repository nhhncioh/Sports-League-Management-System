{% extends "base.html" %}
{% block title %}Match Creation & Scheduling - Admin Panel{% endblock %}

{% block extra_css %}
<style>

.match-creation-hub {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 1rem;
    padding: 2rem;
    color: white;
    margin-bottom: 2rem;
}

.creation-method-card {
    background: white;
    border-radius: 0.75rem;
    padding: 1.5rem;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    transition: all 0.3s ease;
    cursor: pointer;
    border: 2px solid transparent;
    height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: center;
    min-height: 180px;
}

.creation-method-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    border-color: #667eea;
}

.creation-method-card.selected {
    border-color: #667eea;
    background: #f8f9ff;
}

/* Enhanced Creation Method Cards */
.creation-methods-header h2 {
    color: #1e293b;
    font-weight: 600;
}

.creation-methods-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 2rem;
    margin-bottom: 2rem;
}

.creation-method-card.enhanced {
    background: white;
    border-radius: 1rem;
    padding: 0;
    box-shadow: 0 8px 32px rgba(15, 23, 42, 0.08);
    border: 2px solid transparent;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    cursor: pointer;
    overflow: hidden;
    position: relative;
}

.creation-method-card.enhanced:hover {
    transform: translateY(-4px);
    box-shadow: 0 16px 48px rgba(15, 23, 42, 0.15);
    border-color: #3b82f6;
}

.creation-method-card.enhanced.selected {
    border-color: #3b82f6;
    box-shadow: 0 16px 48px rgba(59, 130, 246, 0.2);
    transform: translateY(-4px);
}

.creation-method-card.enhanced.selected::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, #3b82f6, #1d4ed8);
}

.method-header {
    display: flex;
    align-items: flex-start;
    gap: 1rem;
    padding: 2rem 2rem 1rem;
    border-bottom: 1px solid #f1f5f9;
}

.method-icon {
    width: 64px;
    height: 64px;
    border-radius: 1rem;
    background: linear-gradient(135deg, #e0f2fe, #b3e5fc);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    transition: all 0.3s ease;
}

.method-icon i {
    font-size: 2rem;
    color: #0288d1;
}

.creation-method-card.enhanced:hover .method-icon {
    background: linear-gradient(135deg, #3b82f6, #1d4ed8);
    transform: scale(1.1);
}

.creation-method-card.enhanced:hover .method-icon i {
    color: white;
}

.method-info {
    flex: 1;
}

.method-title {
    margin: 0 0 0.5rem 0;
    font-size: 1.25rem;
    font-weight: 600;
    color: #1e293b;
}

.method-subtitle {
    color: #64748b;
    font-size: 0.875rem;
    font-weight: 500;
}

/* Hide wizards by default */
.wizard-step {
    display: none;
}

.method-description {
    padding: 0 2rem 1.5rem;
}

.method-description p {
    color: #475569;
    line-height: 1.6;
    margin: 0 0 1rem 0;
}

.method-features {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.feature-item {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    font-size: 0.875rem;
    color: #64748b;
}

.feature-item i {
    font-size: 1rem;
}

.method-example {
    background: linear-gradient(135deg, #f8fafc, #f1f5f9);
    padding: 1rem 2rem;
    border-top: 1px solid #f1f5f9;
    border-bottom: 1px solid #f1f5f9;
}

.example-label {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.875rem;
    font-weight: 600;
    color: #475569;
    margin-bottom: 0.5rem;
}

.example-label i {
    color: #f59e0b;
}

.example-text {
    font-size: 0.875rem;
    color: #64748b;
    margin: 0;
    line-height: 1.5;
}

.method-action {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1.5rem 2rem;
    background: #fafafa;
    transition: all 0.3s ease;
}

.action-text {
    font-size: 0.875rem;
    font-weight: 600;
    color: #64748b;
    transition: all 0.3s ease;
}

.method-action i {
    color: #cbd5e1;
    transition: all 0.3s ease;
}

.creation-method-card.enhanced:hover .method-action {
    background: #3b82f6;
}

.creation-method-card.enhanced:hover .action-text {
    color: white;
}

.creation-method-card.enhanced:hover .method-action i {
    color: white;
    transform: translateX(4px);
}

@media (max-width: 768px) {
    .method-header {
        padding: 1.5rem 1.5rem 1rem;
    }

    .method-description {
        padding: 0 1.5rem 1rem;
    }

    .method-example {
        padding: 1rem 1.5rem;
    }

    .method-action {
        padding: 1rem 1.5rem;
    }

    .method-icon {
        width: 48px;
        height: 48px;
    }

    .method-icon i {
        font-size: 1.5rem;
    }
}

.wizard-step {
    background: white;
    border-radius: 1rem;
    padding: 2rem;
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    margin-top: 2rem;
}

.step-indicator {
    display: flex;
    justify-content: center;
    margin-bottom: 2rem;
}

.step-indicator .step {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: #e9ecef;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 0.5rem;
    font-weight: 600;
    transition: all 0.3s ease;
}

.step-indicator .step.completed {
    background: #28a745;
    color: white;
}

.step-indicator .step.active {
    background: #667eea;
    color: white;
}

.step-indicator .step-line {
    width: 60px;
    height: 2px;
    background: #e9ecef;
    margin-top: 19px;
}

.step-indicator .step-line.completed {
    background: #28a745;
}

.match-preview-card {
    background: #f8f9fa;
    border: 1px solid #e9ecef;
    border-radius: 0.5rem;
    padding: 1rem;
    margin-bottom: 0.5rem;
}

.existing-matches-section {
    background: white;
    border-radius: 1rem;
    padding: 1.5rem;
    box-shadow: 0 2px 10px rgba(0,0,0,0.08);
}

.match-item {
    background: #f8f9fa;
    border: 1px solid #e9ecef;
    border-radius: 0.5rem;
    padding: 1rem;
    margin-bottom: 0.5rem;
    transition: all 0.2s ease;
}

.match-item:hover {
    background: #e9ecef;
}

.status-badge {
    padding: 0.25rem 0.5rem;
    border-radius: 1rem;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
}

.status-scheduled {
    background: #fff3cd;
    color: #856404;
}

.status-completed {
    background: #d4edda;
    color: #155724;
}

.status-live {
    background: #f8d7da;
    color: #721c24;
    animation: pulse 1.5s infinite;
}

@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.7; }
}
</style>
{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <!-- Page Header -->
    <div class="match-creation-hub">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h1 class="mb-2"><i class="ph ph-calendar-plus me-2"></i>Match Creation & Scheduling</h1>
                <p class="mb-0 opacity-75">Create individual matches or bulk generate fixtures for your leagues</p>
            </div>
            <div class="text-center">
                <div class="display-6 fw-bold">{{ total_matches }}</div>
                <small class="opacity-75">Total Matches</small>
            </div>
        </div>
    </div>

    <div class="row g-4">
        <!-- Match Creation Methods -->
        <div class="col-lg-8">
            <h3 class="mb-4">Create Matches</h3>

            <div class="row g-4">
                <div class="col-md-4">
                    <div class="creation-method-card" onclick="selectCreationMethod('single-match', this)">
                        <div class="text-center">
                            <i class="ph ph-plus-circle display-4 text-primary mb-3"></i>
                            <h5>Create Single Match</h5>
                            <p class="text-muted small">One match at a time</p>
                        </div>
                    </div>
                </div>

                <div class="col-md-4">
                    <div class="creation-method-card" onclick="selectCreationMethod('round-robin', this)">
                        <div class="text-center">
                            <i class="ph ph-arrows-clockwise display-4 text-success mb-3"></i>
                            <h5>Complete League Schedule</h5>
                            <p class="text-muted small">Auto-generate all league matches</p>
                        </div>
                    </div>
                </div>

                <div class="col-md-4">
                    <div class="creation-method-card" onclick="selectCreationMethod('custom-bulk', this)">
                        <div class="text-center">
                            <i class="ph ph-stack display-4 text-warning mb-3"></i>
                            <h5>Bulk Entry</h5>
                            <p class="text-muted small">Multiple matches at once</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Single Match Creation -->
            <div id="single-match-wizard" class="wizard-step">
                <h4 class="mb-3">Create Single Match</h4>
                <form method="post" action="{{ url_for('admin.manage_matches') }}">
                    <input type="hidden" name="action" value="create_single">

                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label">League</label>
                            <select class="form-select" name="league_id" required onchange="loadSeasons(this.value)">
                                <option value="">Select League</option>
                                {% for league in leagues %}
                                <option value="{{ league.league_id }}">{{ league.name }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <div class="col-md-6">
                            <label class="form-label">Season</label>
                            <select class="form-select" name="season_id" id="seasonSelect" required>
                                <option value="">Select Season</option>
                            </select>
                        </div>

                        <div class="col-md-6">
                            <label class="form-label">Home Team</label>
                            <select class="form-select" name="home_team_id" required>
                                <option value="">Select Home Team</option>
                                {% for team in teams %}
                                <option value="{{ team.team_id }}">{{ team.name }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <div class="col-md-6">
                            <label class="form-label">Away Team</label>
                            <select class="form-select" name="away_team_id" required>
                                <option value="">Select Away Team</option>
                                {% for team in teams %}
                                <option value="{{ team.team_id }}">{{ team.name }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <div class="col-md-6">
                            <label class="form-label">Match Date</label>
                            <input type="date" class="form-control" name="match_date" required>
                        </div>

                        <div class="col-md-6">
                            <label class="form-label">Match Time</label>
                            <input type="time" class="form-control" name="match_time">
                        </div>

                        <div class="col-md-6">
                            <label class="form-label">Matchday</label>
                            <input type="number" class="form-control" name="matchday" min="1">
                        </div>

                        <div class="col-md-6">
                            <label class="form-label">Venue</label>
                            <select class="form-select" name="venue_id">
                                <option value="">Select Venue</option>
                                {% for venue in venues %}
                                <option value="{{ venue.venue_id }}">{{ venue.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>

                    <div class="mt-4">
                        <button type="submit" class="btn btn-primary">
                            <i class="ph ph-plus me-2"></i>Create Match
                        </button>
                        <button type="button" class="btn btn-secondary ms-2" onclick="clearCreationMethod()">Cancel</button>
                    </div>
                </form>
            </div>

            <!-- Round Robin Wizard -->
            <div id="round-robin-wizard" class="wizard-step">
                <div class="step-indicator">
                    <div class="step active" id="rr-step-1">1</div>
                    <div class="step-line"></div>
                    <div class="step" id="rr-step-2">2</div>
                    <div class="step-line"></div>
                    <div class="step" id="rr-step-3">3</div>
                </div>

                <form method="post" action="{{ url_for('admin.manage_matches') }}" id="roundRobinForm">
                    <input type="hidden" name="action" value="create_round_robin">

                    <!-- Step 1: Basic Settings -->
                    <div class="wizard-content" id="rr-content-1">
                        <h4 class="mb-3">League Schedule Settings</h4>

                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">League</label>
                                <select class="form-select" name="rr_league_id" required>
                                    <option value="">Select League</option>
                                    {% for league in leagues %}
                                    <option value="{{ league.league_id }}">{{ league.name }}</option>
                                    {% endfor %}
                                </select>
                            </div>

                            <div class="col-md-6">
                                <label class="form-label">Season</label>
                                <select class="form-select" name="rr_season_id" required>
                                    <option value="">Select Season</option>
                                    {% for season in seasons %}
                                    <option value="{{ season.season_id }}">{{ season.name }}</option>
                                    {% endfor %}
                                </select>
                            </div>

                            <div class="col-md-6">
                                <label class="form-label">Schedule Type</label>
                                <select class="form-select" name="fixture_type" required>
                                    <option value="single">Single Round (Each team plays once)</option>
                                    <option value="double">Double Round (Home & Away)</option>
                                </select>
                            </div>

                            <div class="col-md-6">
                                <label class="form-label">Start Date</label>
                                <input type="date" class="form-control" name="start_date" required>
                            </div>
                        </div>

                        <div class="mt-4">
                            <button type="button" class="btn btn-primary" onclick="nextRRStep(2)">
                                Next <i class="ph ph-arrow-right ms-2"></i>
                            </button>
                            <button type="button" class="btn btn-secondary ms-2" onclick="clearCreationMethod()">Cancel</button>
                        </div>
                    </div>

                    <!-- Step 2: Team Selection -->
                    <div class="wizard-content" id="rr-content-2" style="display: none;">
                        <h4 class="mb-3">Select Teams</h4>

                        <div class="row">
                            <div class="col-md-8">
                                <h6>Available Teams</h6>
                                <div class="border rounded p-3" style="max-height: 300px; overflow-y: auto;">
                                    {% for team in teams %}
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="selected_teams"
                                               value="{{ team.team_id }}" id="team-{{ team.team_id }}">
                                        <label class="form-check-label" for="team-{{ team.team_id }}">
                                            {{ team.name }}
                                        </label>
                                    </div>
                                    {% endfor %}
                                </div>

                                <div class="mt-2">
                                    <button type="button" class="btn btn-sm btn-outline-primary" onclick="selectAllTeams()">Select All</button>
                                    <button type="button" class="btn btn-sm btn-outline-secondary ms-2" onclick="clearAllTeams()">Clear All</button>
                                </div>
                            </div>

                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-header">
                                        <h6 class="mb-0">Fixture Preview</h6>
                                    </div>
                                    <div class="card-body">
                                        <div id="fixture-preview">
                                            <p class="text-muted small">Select teams to see fixture count</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="mt-4">
                            <button type="button" class="btn btn-secondary" onclick="prevRRStep(1)">
                                <i class="ph ph-arrow-left me-2"></i>Previous
                            </button>
                            <button type="button" class="btn btn-primary ms-2" onclick="nextRRStep(3)">
                                Next <i class="ph ph-arrow-right ms-2"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Step 3: Review & Generate -->
                    <div class="wizard-content" id="rr-content-3" style="display: none;">
                        <h4 class="mb-3">Review & Generate</h4>

                        <div id="generation-preview"></div>

                        <div class="mt-4">
                            <button type="button" class="btn btn-secondary" onclick="prevRRStep(2)">
                                <i class="ph ph-arrow-left me-2"></i>Previous
                            </button>
                            <button type="submit" class="btn btn-success ms-2">
                                <i class="ph ph-magic-wand me-2"></i>Generate Fixtures
                            </button>
                        </div>
                    </div>
                </form>
            </div>

            <!-- Custom Bulk Creation -->
            <div id="custom-bulk-wizard" class="wizard-step">
                <h4 class="mb-3">Bulk Match Upload</h4>
                <p class="text-muted mb-4">Upload an Excel file to create multiple matches at once</p>

                <div class="row">
                    <div class="col-lg-8">
                        <form method="post" action="{{ url_for('admin.manage_matches') }}" enctype="multipart/form-data" id="bulkUploadForm">
                            <input type="hidden" name="action" value="bulk_upload">

                            <div class="card mb-3">
                                <div class="card-header bg-primary text-white">
                                    <i class="ph ph-file-arrow-up me-2"></i>Upload Excel File
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <label class="form-label fw-semibold">Select Excel File</label>
                                        <input type="file" class="form-control" name="bulk_file" accept=".xlsx,.xls" required>
                                        <small class="text-muted">Supported formats: .xlsx, .xls</small>
                                    </div>

                                    <div class="alert alert-info">
                                        <strong><i class="ph ph-info me-2"></i>Excel File Format Requirements:</strong>
                                        <p class="mb-2 mt-2">Your Excel file should contain the following columns (in this order):</p>
                                        <ol class="mb-0 small">
                                            <li><strong>League Name</strong> - Name of the league (must exist)</li>
                                            <li><strong>Season Name</strong> - Name of the season (must exist)</li>
                                            <li><strong>Home Team</strong> - Name of home team (must exist)</li>
                                            <li><strong>Away Team</strong> - Name of away team (must exist)</li>
                                            <li><strong>Match Date</strong> - Format: YYYY-MM-DD (e.g., 2025-10-15)</li>
                                            <li><strong>Match Time</strong> - Format: HH:MM (e.g., 14:30) - Optional</li>
                                            <li><strong>Venue</strong> - Venue name (optional)</li>
                                            <li><strong>Matchday</strong> - Matchday number (optional)</li>
                                        </ol>
                                    </div>

                                    <div class="mb-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="skipErrors" name="skip_errors" value="1">
                                            <label class="form-check-label" for="skipErrors">
                                                Skip rows with errors (create valid matches only)
                                            </label>
                                        </div>
                                    </div>

                                    <div class="d-flex gap-2">
                                        <button type="submit" class="btn btn-primary">
                                            <i class="ph ph-upload me-2"></i>Upload & Import
                                        </button>
                                        <button type="button" class="btn btn-secondary" onclick="clearCreationMethod()">Cancel</button>
                                        <a href="{{ url_for('admin.download_bulk_template') }}" class="btn btn-outline-success ms-auto">
                                            <i class="ph ph-download me-2"></i>Download Template
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>

                    <div class="col-lg-4">
                        <div class="card">
                            <div class="card-header">
                                <i class="ph ph-lightbulb me-2"></i>Tips
                            </div>
                            <div class="card-body">
                                <ul class="small mb-0">
                                    <li class="mb-2">Download the template to get started</li>
                                    <li class="mb-2">Make sure all team and league names match exactly</li>
                                    <li class="mb-2">The first row should contain column headers</li>
                                    <li class="mb-2">Dates must be in YYYY-MM-DD format</li>
                                    <li class="mb-2">You can leave optional fields blank</li>
                                    <li>Maximum 500 matches per upload</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Existing Matches Sidebar -->
        <div class="col-lg-4">
            <div class="existing-matches-section">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5 class="mb-0">Recent Matches</h5>
                    <a href="{{ url_for('admin.manage_scores') }}" class="btn btn-sm btn-outline-primary">
                        <i class="ph ph-pencil me-1"></i>Manage Scores
                    </a>
                </div>

                {% if recent_matches %}
                    {% for match in recent_matches %}
                    <div class="match-item">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <div>
                                <div class="fw-bold">{{ match.home_team }} vs {{ match.away_team }}</div>
                                <small class="text-muted">{{ match.utc_date }} - Matchday {{ match.matchday }}</small>
                            </div>
                            <span class="status-badge status-{{ match.status }}">{{ match.status }}</span>
                        </div>

                        {% if match.status == 'completed' and match.home_score is not none %}
                        <div class="text-center py-2">
                            <span class="badge bg-light text-dark fs-6">{{ match.home_score }} - {{ match.away_score }}</span>
                        </div>
                        {% endif %}
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="text-center py-4 text-muted">
                        <i class="ph ph-calendar-x display-6 mb-3"></i>
                        <p>No matches created yet</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<script>
function clearCreationMethod() {
    // Hide all wizards
    document.querySelectorAll('.wizard-step').forEach(wizard => {
        wizard.style.display = 'none';
    });

    // Deselect all cards
    document.querySelectorAll('.creation-method-card').forEach(card => {
        card.classList.remove('selected');
    });
}

function nextRRStep(step) {
    // Hide current step
    document.getElementById(`rr-content-${currentRRStep}`).style.display = 'none';
    document.getElementById(`rr-step-${currentRRStep}`).classList.remove('active');
    document.getElementById(`rr-step-${currentRRStep}`).classList.add('completed');

    // Show next step
    currentRRStep = step;
    document.getElementById(`rr-content-${currentRRStep}`).style.display = 'block';
    document.getElementById(`rr-step-${currentRRStep}`).classList.add('active');

    // Update preview if on step 3
    if (step === 3) {
        updateGenerationPreview();
    }
}

function prevRRStep(step) {
    // Hide current step
    document.getElementById(`rr-content-${currentRRStep}`).style.display = 'none';
    document.getElementById(`rr-step-${currentRRStep}`).classList.remove('active');

    // Show previous step
    currentRRStep = step;
    document.getElementById(`rr-content-${currentRRStep}`).style.display = 'block';
    document.getElementById(`rr-step-${currentRRStep}`).classList.add('active');
    document.getElementById(`rr-step-${currentRRStep}`).classList.remove('completed');
}

function selectAllTeams() {
    document.querySelectorAll('input[name="selected_teams"]').forEach(checkbox => {
        checkbox.checked = true;
    });
    updateFixturePreview();
}

function clearAllTeams() {
    document.querySelectorAll('input[name="selected_teams"]').forEach(checkbox => {
        checkbox.checked = false;
    });
    updateFixturePreview();
}

function updateFixturePreview() {
    const selectedTeams = document.querySelectorAll('input[name="selected_teams"]:checked');
    const count = selectedTeams.length;
    const fixtureType = document.querySelector('select[name="fixture_type"]').value;

    if (count < 2) {
        document.getElementById('fixture-preview').innerHTML = '<p class="text-muted small">Select at least 2 teams</p>';
        return;
    }

    const matchesPerRound = count * (count - 1) / 2;
    const totalMatches = fixtureType === 'double' ? matchesPerRound * 2 : matchesPerRound;

    document.getElementById('fixture-preview').innerHTML = `
        <div class="text-center">
            <div class="display-6 text-primary">${totalMatches}</div>
            <small class="text-muted">Total Matches</small>
            <hr>
            <div><strong>${count}</strong> Teams</div>
            <div><strong>${fixtureType === 'double' ? '2' : '1'}</strong> Rounds</div>
        </div>
    `;
}

function updateGenerationPreview() {
    const selectedTeams = Array.from(document.querySelectorAll('input[name="selected_teams"]:checked'));
    const league = document.querySelector('select[name="rr_league_id"] option:checked').text;
    const season = document.querySelector('select[name="rr_season_id"] option:checked').text;
    const fixtureType = document.querySelector('select[name="fixture_type"]').value;
    const startDate = document.querySelector('input[name="start_date"]').value;

    const count = selectedTeams.length;
    const matchesPerRound = count * (count - 1) / 2;
    const totalMatches = fixtureType === 'double' ? matchesPerRound * 2 : matchesPerRound;

    document.getElementById('generation-preview').innerHTML = `
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0">Generation Summary</h6>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-6">
                        <strong>League:</strong> ${league}<br>
                        <strong>Season:</strong> ${season}<br>
                        <strong>Start Date:</strong> ${startDate}
                    </div>
                    <div class="col-md-6">
                        <strong>Teams:</strong> ${count}<br>
                        <strong>Type:</strong> ${fixtureType === 'double' ? 'Double Round (Home & Away)' : 'Single Round'}<br>
                        <strong>Total Matches:</strong> ${totalMatches}
                    </div>
                </div>

                <hr>

                <h6>Selected Teams:</h6>
                <div class="d-flex flex-wrap gap-2">
                    ${selectedTeams.map(team => `<span class="badge bg-primary">${team.nextElementSibling.textContent}</span>`).join('')}
                </div>
            </div>
        </div>
    `;
}

// Add event listeners
document.addEventListener('DOMContentLoaded', function() {
    // Update fixture preview when teams are selected
    document.querySelectorAll('input[name="selected_teams"]').forEach(checkbox => {
        checkbox.addEventListener('change', updateFixturePreview);
    });

    // Update preview when fixture type changes
    document.querySelector('select[name="fixture_type"]').addEventListener('change', updateFixturePreview);
});

function loadSeasons(leagueId) {
    if (!leagueId) {
        document.getElementById('seasonSelect').innerHTML = '<option value="">Select Season</option>';
        return;
    }

    fetch(`/admin/api/seasons/${leagueId}`)
        .then(response => response.json())
        .then(seasons => {
            const select = document.getElementById('seasonSelect');
            select.innerHTML = '<option value="">Select Season</option>';
            seasons.forEach(season => {
                select.innerHTML += `<option value="${season.season_id}">${season.name}</option>`;
            });
        });
}
</script>
{% endblock %}

{% block extra_js %}
<script>
// Simple cache bust v2.0
let currentRRStep = 1;

function selectCreationMethod(method, element) {
    console.log('Click detected for method:', method);

    // Clear all selections
    document.querySelectorAll('.creation-method-card').forEach(card => {
        card.classList.remove('selected');
    });

    // Mark this card as selected
    if (element) {
        element.classList.add('selected');
    }

    // Hide all wizards first
    document.querySelectorAll('.wizard-step').forEach(wizard => {
        wizard.style.display = 'none';
    });

    // Show the selected wizard
    const wizardId = method + '-wizard';
    const wizard = document.getElementById(wizardId);

    if (wizard) {
        wizard.style.display = 'block';
        console.log('Showing wizard:', wizardId);
    } else {
        console.error('Wizard not found:', wizardId);
    }
}

function backToMethodSelection() {
    // Hide all wizards
    document.querySelectorAll('.wizard-step').forEach(wizard => {
        wizard.style.display = 'none';
    });

    // Deselect all cards
    document.querySelectorAll('.creation-method-card').forEach(card => {
        card.classList.remove('selected');
    });
}
</script>
{% endblock %}