{% extends "base.html" %}
{% block title %}Player Management - CRM{% endblock %}
{% block content %}
<div class="container-fluid py-4">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{{ url_for('admin.admin_dashboard') }}">Admin</a></li>
                    <li class="breadcrumb-item active">Player Management</li>
                </ol>
            </nav>

            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1>Player Management CRM</h1>
                    <p class="text-muted">Comprehensive player database and relationship management</p>
                </div>
                <div>
                    <div class="btn-group" role="group">
                        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addPlayerModal">
                            <i class="ph ph-plus"></i> Add Player
                        </button>
                        <a href="{{ url_for('admin.export_players') }}" class="btn btn-outline-success">
                            <i class="ph ph-download"></i> Export
                        </a>
                        <button type="button" class="btn btn-outline-info" data-bs-toggle="modal" data-bs-target="#importPlayersModal">
                            <i class="ph ph-upload"></i> Import
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Stats Dashboard -->
    <div class="row mb-4">
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="card stat-card">
                <div class="card-body d-flex align-items-center">
                    <div class="stat-icon bg-primary">
                        <i class="ph ph-users"></i>
                    </div>
                    <div class="ms-3">
                        <h3 class="text-primary mb-0">{{ players|length }}</h3>
                        <small class="text-muted">Total Players</small>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="card stat-card">
                <div class="card-body d-flex align-items-center">
                    <div class="stat-icon bg-success">
                        <i class="ph ph-check-circle"></i>
                    </div>
                    <div class="ms-3">
                        <h3 class="text-success mb-0">{{ players|length }}</h3>
                        <small class="text-muted">Active Players</small>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="card stat-card">
                <div class="card-body d-flex align-items-center">
                    <div class="stat-icon bg-warning">
                        <i class="ph ph-users-three"></i>
                    </div>
                    <div class="ms-3">
                        <h3 class="text-warning mb-0">{{ teams|length }}</h3>
                        <small class="text-muted">Teams</small>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="card stat-card">
                <div class="card-body d-flex align-items-center">
                    <div class="stat-icon bg-info">
                        <i class="ph ph-globe"></i>
                    </div>
                    <div class="ms-3">
                        <h3 class="text-info mb-0">{{ players|map(attribute=5)|unique|list|length }}</h3>
                        <small class="text-muted">Nationalities</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Advanced Filters -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="ph ph-funnel"></i> Advanced Filters & Search
                        </h5>
                        <button type="button" class="btn btn-sm btn-outline-secondary" onclick="clearAllFilters()">
                            <i class="ph ph-x"></i> Clear All
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3">
                            <label for="filter-search" class="form-label">Quick Search</label>
                            <input type="text" class="form-control" id="filter-search" placeholder="Name, jersey number..." onkeyup="filterPlayers()">
                        </div>
                        <div class="col-md-2">
                            <label for="filter-team" class="form-label">Team</label>
                            <select class="form-select" id="filter-team" onchange="filterPlayers()">
                                <option value="">All Teams</option>
                                {% for team in teams %}
                                <option value="{{ team[1] }}">{{ team[1] }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label for="filter-position" class="form-label">Position</label>
                            <select class="form-select" id="filter-position" onchange="filterPlayers()">
                                <option value="">All Positions</option>
                                <option value="goalkeeper">Goalkeeper</option>
                                <option value="defender">Defender</option>
                                <option value="midfielder">Midfielder</option>
                                <option value="forward">Forward</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label for="filter-status" class="form-label">Status</label>
                            <select class="form-select" id="filter-status" onchange="filterPlayers()">
                                <option value="">All Status</option>
                                <option value="active">Active</option>
                                <option value="injured">Injured</option>
                                <option value="suspended">Suspended</option>
                                <option value="inactive">Inactive</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label for="filter-age" class="form-label">Age Range</label>
                            <select class="form-select" id="filter-age" onchange="filterPlayers()">
                                <option value="">All Ages</option>
                                <option value="16-20">16-20 years</option>
                                <option value="21-25">21-25 years</option>
                                <option value="26-30">26-30 years</option>
                                <option value="31+">31+ years</option>
                            </select>
                        </div>
                        <div class="col-md-1">
                            <label class="form-label">&nbsp;</label>
                            <button type="button" class="btn btn-outline-primary w-100" data-bs-toggle="collapse" data-bs-target="#advancedFilters">
                                <i class="ph ph-plus"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Advanced Filters Collapse -->
                    <div class="collapse mt-3" id="advancedFilters">
                        <hr>
                        <div class="row">
                            <div class="col-md-3">
                                <label for="filter-nationality" class="form-label">Nationality</label>
                                <select class="form-select" id="filter-nationality" onchange="filterPlayers()">
                                    <option value="">All Nationalities</option>
                                    {% for nationality in players|map(attribute=5)|unique|list %}
                                    <option value="{{ nationality }}">{{ nationality }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label for="filter-contract" class="form-label">Contract Status</label>
                                <select class="form-select" id="filter-contract" onchange="filterPlayers()">
                                    <option value="">All Contracts</option>
                                    <option value="active">Active Contract</option>
                                    <option value="expiring">Expiring Soon</option>
                                    <option value="expired">Expired</option>
                                    <option value="trial">Trial</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label for="filter-registration" class="form-label">Registration</label>
                                <select class="form-select" id="filter-registration" onchange="filterPlayers()">
                                    <option value="">All</option>
                                    <option value="registered">Registered</option>
                                    <option value="pending">Pending</option>
                                    <option value="incomplete">Incomplete</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label for="filter-created" class="form-label">Added</label>
                                <select class="form-select" id="filter-created" onchange="filterPlayers()">
                                    <option value="">Any Time</option>
                                    <option value="today">Today</option>
                                    <option value="week">This Week</option>
                                    <option value="month">This Month</option>
                                    <option value="year">This Year</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- View Toggle and Bulk Actions -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div class="d-flex align-items-center">
                            <div class="form-check me-3">
                                <input type="checkbox" class="form-check-input" id="selectAll" onchange="toggleSelectAll()">
                                <label class="form-check-label" for="selectAll">
                                    Select All
                                </label>
                            </div>
                            <div class="bulk-actions" id="bulkActions" style="display: none;">
                                <div class="btn-group" role="group">
                                    <button type="button" class="btn btn-sm btn-outline-success" onclick="bulkStatusUpdate('active')">
                                        Mark Active
                                    </button>
                                    <button type="button" class="btn btn-sm btn-outline-warning" onclick="bulkStatusUpdate('inactive')">
                                        Mark Inactive
                                    </button>
                                    <button type="button" class="btn btn-sm btn-outline-info" onclick="bulkExport()">
                                        Export Selected
                                    </button>
                                    <button type="button" class="btn btn-sm btn-outline-danger" onclick="bulkDelete()">
                                        Delete Selected
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div>
                            <span class="text-muted me-3">
                                Showing <span id="playerCount">{{ players|length }}</span> players
                            </span>
                            <div class="btn-group" role="group">
                                <button type="button" class="btn btn-sm btn-outline-primary active" id="tableViewBtn" onclick="toggleView('table')">
                                    <i class="ph ph-table"></i> Table
                                </button>
                                <button type="button" class="btn btn-sm btn-outline-primary" id="cardViewBtn" onclick="toggleView('cards')">
                                    <i class="ph ph-grid-four"></i> Cards
                                </button>
                                <button type="button" class="btn btn-sm btn-outline-primary" id="listViewBtn" onclick="toggleView('list')">
                                    <i class="ph ph-list"></i> List
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Players Data Views -->
    <div class="row">
        <div class="col-12">
            <!-- Table View -->
            <div id="tableView">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="ph ph-table"></i> Players Database
                        </h5>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-hover mb-0" id="playersTable">
                                <thead class="table-light">
                                    <tr>
                                        <th width="40">
                                            <input type="checkbox" class="form-check-input" id="tableSelectAll">
                                        </th>
                                        <th>Player</th>
                                        <th>Team</th>
                                        <th>Position</th>
                                        <th>Age</th>
                                        <th>Status</th>
                                        <th>Contract</th>
                                        <th>Performance</th>
                                        <th width="120">Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for player in players %}
                                    <tr class="player-row"
                                        data-team="{{ player[1] }}"
                                        data-position="{{ player[3] }}"
                                        data-status="active"
                                        data-nationality="{{ player[5] }}"
                                        data-player-data="{{ player[2] }}">
                                        <td>
                                            <input type="checkbox" class="form-check-input player-checkbox" value="{{ player[0] }}">
                                        </td>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <div class="player-avatar">
                                                    <div class="avatar-placeholder">
                                                        <i class="ph ph-user"></i>
                                                    </div>
                                                </div>
                                                <div class="ms-3">
                                                    <h6 class="mb-0">{{ player[2] }}</h6>
                                                    <small class="text-muted">{{ player[5] }}</small>
                                                </div>
                                            </div>
                                        </td>
                                        <td>
                                            <span class="team-badge">{{ player[1] }}</span>
                                        </td>
                                        <td>
                                            <span class="position-pill position-{{ player[3].lower() }}">
                                                {{ player[3] }}
                                            </span>
                                        </td>
                                        <td>
                                            {% if player[4] %}
                                                Born {{ player[4].year }}
                                            {% else %}
                                                Unknown
                                            {% endif %}
                                        </td>
                                        <td>
                                            <span class="badge status-badge status-active">
                                                Active
                                            </span>
                                        </td>
                                        <td>
                                            <div class="contract-info">
                                                <small class="d-block">No contract data</small>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="performance-rating">
                                                <div class="rating-bar">
                                                    <div class="rating-fill" style="width: 75%;"></div>
                                                </div>
                                                <small>75/100</small>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="btn-group" role="group">
                                                <button class="btn btn-sm btn-outline-info"
                                                        onclick="viewPlayerProfile('{{ player[0] }}')"
                                                        title="View Profile">
                                                    <i class="ph ph-eye"></i>
                                                </button>
                                                <button class="btn btn-sm btn-outline-primary"
                                                        onclick="editPlayer('{{ player[0] }}', '{{ player[6] }}', '{{ player[2] }}', '{{ player[3] }}', '{{ player[4] }}', '{{ player[5] }}', '{{ player[7] or '' }}', '{{ player[8] or '' }}', '{{ player[9] or '' }}', '{{ player[10] }}')"
                                                        title="Edit">
                                                    <i class="ph ph-pencil"></i>
                                                </button>
                                                <button class="btn btn-sm btn-outline-danger"
                                                        data-bs-toggle="modal"
                                                        data-bs-target="#deleteModal"
                                                        data-id="{{ player[0] }}"
                                                        title="Delete">
                                                    <i class="ph ph-trash"></i>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Cards View -->
            <div id="cardsView" style="display: none;">
                <div class="row" id="playerCards">
                    {% for player in players %}
                    <div class="col-xl-3 col-lg-4 col-md-6 mb-4 player-card"
                         data-team="{{ player[1] }}"
                         data-position="{{ player[3] }}"
                         data-status="active"
                         data-nationality="{{ player[5] }}"
                         data-player-data="{{ player[2] }}">
                        <div class="card h-100 player-profile-card">
                            <div class="card-header text-center">
                                <div class="player-avatar-large mb-2">
                                    <div class="avatar-placeholder-large">
                                        <i class="ph ph-user"></i>
                                    </div>
                                </div>
                                <h6 class="mb-1">{{ player[2] }}</h6>
                                <div class="d-flex justify-content-between align-items-center">
                                    <small class="text-muted">Player</small>
                                    <span class="badge status-badge status-active">
                                        Active
                                    </span>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="player-details">
                                    <div class="detail-row">
                                        <span class="detail-label">Team:</span>
                                        <span class="team-badge-small">{{ player[1] }}</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Position:</span>
                                        <span class="position-pill position-{{ player[3].lower() }}">{{ player[3] }}</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Age:</span>
                                        <span>
                                            {% if player[4] %}
                                                Born {{ player[4].year }}
                                            {% else %}
                                                Unknown
                                            {% endif %}
                                        </span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Nationality:</span>
                                        <span>{{ player[5] }}</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Contract:</span>
                                        <span>No contract data</span>
                                    </div>
                                </div>

                                <div class="performance-section mt-3">
                                    <small class="text-muted">Performance Rating</small>
                                    <div class="rating-bar mb-2">
                                        <div class="rating-fill" style="width: 75%;"></div>
                                    </div>
                                    <div class="text-center">
                                        <small><strong>75/100</strong></small>
                                    </div>
                                </div>
                            </div>
                            <div class="card-footer text-center">
                                <div class="btn-group w-100" role="group">
                                    <button class="btn btn-sm btn-outline-info"
                                            onclick="viewPlayerProfile('{{ player[0] }}')"
                                            title="View Profile">
                                        <i class="ph ph-eye"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-primary"
                                            onclick="editPlayer('{{ player[0] }}', '{{ player[6] }}', '{{ player[2] }}', '{{ player[3] }}', '{{ player[4] }}', '{{ player[5] }}', '{{ player[7] or '' }}', '{{ player[8] or '' }}', '{{ player[9] or '' }}', '{{ player[10] }}')"
                                            title="Edit">
                                        <i class="ph ph-pencil"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-success"
                                            onclick="contactPlayer('{{ player[0] }}')"
                                            title="Contact">
                                        <i class="ph ph-phone"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- List View -->
            <div id="listView" style="display: none;">
                <div class="card">
                    <div class="card-body p-0">
                        <div class="list-group list-group-flush" id="playersList">
                            {% for player in players %}
                            <div class="list-group-item player-list-item"
                                 data-team="{{ player[1] }}"
                                 data-position="{{ player[3] }}"
                                 data-status="active"
                                 data-nationality="{{ player[5] }}"
                                 data-player-data="{{ player[2] }}">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div class="d-flex align-items-center">
                                        <input type="checkbox" class="form-check-input me-3 player-checkbox" value="{{ player[0] }}">
                                        <div class="player-avatar-small me-3">
                                            <div class="avatar-placeholder-small">
                                                <i class="ph ph-user"></i>
                                            </div>
                                        </div>
                                        <div>
                                            <h6 class="mb-1">{{ player[2] }}</h6>
                                            <small class="text-muted">
                                                {{ player[1] }} • {{ player[3] }} • {{ player[5] }}
                                            </small>
                                        </div>
                                    </div>
                                    <div class="d-flex align-items-center gap-2">
                                        <span class="badge status-badge status-active">Active</span>
                                        <div class="btn-group" role="group">
                                            <button class="btn btn-sm btn-outline-info" onclick="viewPlayerProfile('{{ player[0] }}')">
                                                <i class="ph ph-eye"></i>
                                            </button>
                                            <button class="btn btn-sm btn-outline-primary" onclick="editPlayer('{{ player[0] }}', '{{ player[6] }}', '{{ player[2] }}', '{{ player[3] }}', '{{ player[4] }}', '{{ player[5] }}')">
                                                <i class="ph ph-pencil"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Add/Edit Player Modal -->
<div class="modal fade" id="addPlayerModal" tabindex="-1" aria-labelledby="addPlayerModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <form action="{{ url_for('admin.manage_players') }}" method="POST" enctype="multipart/form-data">
                <div class="modal-header">
                    <h5 class="modal-title" id="addPlayerModalLabel">Add New Player</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="player_id" name="player_id">

                    <h6 class="mb-3">Player Information</h6>

                    <!-- Simplified Form for Current Database Structure -->
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="name" class="form-label">Player Name *</label>
                                <input type="text" class="form-control" id="name" name="name" required placeholder="Full name">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="team_id" class="form-label">Team *</label>
                                <select class="form-select" id="team_id" name="team_id" required>
                                    <option value="">Select Team</option>
                                    {% for team in teams %}
                                    <option value="{{ team[0] }}">{{ team[1] }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="position" class="form-label">Position *</label>
                                <select class="form-select" id="position" name="position" required>
                                    <option value="">Select Position</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="date_of_birth" class="form-label">Date of Birth *</label>
                                <input type="date" class="form-control" id="date_of_birth" name="date_of_birth" required>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="nationality" class="form-label">Nationality *</label>
                                <input type="text" class="form-control" id="nationality" name="nationality" required placeholder="e.g., American, British">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="sport" class="form-label">Sport *</label>
                                <select class="form-select" id="sport" name="sport" required>
                                    {% for sport_data in sports %}
                                    <option value="{{ sport_data[0] }}" {% if sport_data[0] == 'Football' %}selected{% endif %}>{{ sport_data[0] }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="email" class="form-label">Email Address</label>
                                <input type="email" class="form-control" id="email" name="email" placeholder="player@example.com">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="weight_kg" class="form-label">Weight (kg)</label>
                                <input type="number" class="form-control" id="weight_kg" name="weight_kg" step="0.1" min="0" max="300" placeholder="e.g., 75.5">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="height_cm" class="form-label">Height (cm)</label>
                                <input type="number" class="form-control" id="height_cm" name="height_cm" min="0" max="300" placeholder="e.g., 180">
                            </div>
                        </div>
                    </div>

                        <!-- Contact Tab -->
                        <div class="tab-pane fade" id="contact" role="tabpanel">
                            <div class="row">
                                <div class="col-md-6">
                                    <h6 class="mb-3">Contact Information</h6>
                                    <div class="mb-3">
                                        <label for="email" class="form-label">Email Address</label>
                                        <input type="email" class="form-control" id="email" name="email">
                                    </div>
                                    <div class="mb-3">
                                        <label for="phone_primary" class="form-label">Primary Phone</label>
                                        <input type="tel" class="form-control" id="phone_primary" name="phone_primary">
                                    </div>
                                    <div class="mb-3">
                                        <label for="phone_secondary" class="form-label">Secondary Phone</label>
                                        <input type="tel" class="form-control" id="phone_secondary" name="phone_secondary">
                                    </div>
                                    <div class="mb-3">
                                        <label for="address" class="form-label">Home Address</label>
                                        <textarea class="form-control" id="address" name="address" rows="3"></textarea>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="city" class="form-label">City</label>
                                                <input type="text" class="form-control" id="city" name="city">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="postal_code" class="form-label">Postal Code</label>
                                                <input type="text" class="form-control" id="postal_code" name="postal_code">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <h6 class="mb-3">Emergency Contact</h6>
                                    <div class="mb-3">
                                        <label for="emergency_name" class="form-label">Contact Name</label>
                                        <input type="text" class="form-control" id="emergency_name" name="emergency_name">
                                    </div>
                                    <div class="mb-3">
                                        <label for="emergency_relationship" class="form-label">Relationship</label>
                                        <select class="form-select" id="emergency_relationship" name="emergency_relationship">
                                            <option value="">Select</option>
                                            <option value="parent">Parent</option>
                                            <option value="spouse">Spouse</option>
                                            <option value="sibling">Sibling</option>
                                            <option value="guardian">Guardian</option>
                                            <option value="friend">Friend</option>
                                            <option value="other">Other</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label for="emergency_phone" class="form-label">Emergency Phone</label>
                                        <input type="tel" class="form-control" id="emergency_phone" name="emergency_phone">
                                    </div>
                                    <div class="mb-3">
                                        <label for="emergency_email" class="form-label">Emergency Email</label>
                                        <input type="email" class="form-control" id="emergency_email" name="emergency_email">
                                    </div>

                                    <h6 class="mb-3 mt-4">Social Media</h6>
                                    <div class="mb-3">
                                        <label for="social_instagram" class="form-label">Instagram</label>
                                        <input type="text" class="form-control" id="social_instagram" name="social_instagram" placeholder="@username">
                                    </div>
                                    <div class="mb-3">
                                        <label for="social_twitter" class="form-label">Twitter</label>
                                        <input type="text" class="form-control" id="social_twitter" name="social_twitter" placeholder="@username">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Contract Tab -->
                        <div class="tab-pane fade" id="contract" role="tabpanel">
                            <div class="row">
                                <div class="col-md-6">
                                    <h6 class="mb-3">Contract Details</h6>
                                    <div class="mb-3">
                                        <label for="contract_start" class="form-label">Contract Start Date</label>
                                        <input type="date" class="form-control" id="contract_start" name="contract_start">
                                    </div>
                                    <div class="mb-3">
                                        <label for="contract_end" class="form-label">Contract End Date</label>
                                        <input type="date" class="form-control" id="contract_end" name="contract_end">
                                    </div>
                                    <div class="mb-3">
                                        <label for="contract_type" class="form-label">Contract Type</label>
                                        <select class="form-select" id="contract_type" name="contract_type">
                                            <option value="">Select Type</option>
                                            <option value="professional">Professional</option>
                                            <option value="amateur">Amateur</option>
                                            <option value="youth">Youth</option>
                                            <option value="trial">Trial</option>
                                            <option value="loan">Loan</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label for="salary_annual" class="form-label">Annual Salary</label>
                                        <input type="number" class="form-control" id="salary_annual" name="salary_annual" min="0" step="1000">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <h6 class="mb-3">Additional Terms</h6>
                                    <div class="mb-3">
                                        <label for="agent_name" class="form-label">Agent Name</label>
                                        <input type="text" class="form-control" id="agent_name" name="agent_name">
                                    </div>
                                    <div class="mb-3">
                                        <label for="agent_phone" class="form-label">Agent Phone</label>
                                        <input type="tel" class="form-control" id="agent_phone" name="agent_phone">
                                    </div>
                                    <div class="mb-3">
                                        <label for="agent_email" class="form-label">Agent Email</label>
                                        <input type="email" class="form-control" id="agent_email" name="agent_email">
                                    </div>
                                    <div class="mb-3">
                                        <label for="registration_status" class="form-label">Registration Status</label>
                                        <select class="form-select" id="registration_status" name="registration_status">
                                            <option value="registered">Registered</option>
                                            <option value="pending">Pending</option>
                                            <option value="incomplete">Incomplete</option>
                                            <option value="expired">Expired</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label for="contract_notes" class="form-label">Contract Notes</label>
                                        <textarea class="form-control" id="contract_notes" name="contract_notes" rows="4"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Medical Tab -->
                        <div class="tab-pane fade" id="medical" role="tabpanel">
                            <div class="row">
                                <div class="col-md-6">
                                    <h6 class="mb-3">Medical Information</h6>
                                    <div class="mb-3">
                                        <label for="blood_type" class="form-label">Blood Type</label>
                                        <select class="form-select" id="blood_type" name="blood_type">
                                            <option value="">Select</option>
                                            <option value="A+">A+</option>
                                            <option value="A-">A-</option>
                                            <option value="B+">B+</option>
                                            <option value="B-">B-</option>
                                            <option value="AB+">AB+</option>
                                            <option value="AB-">AB-</option>
                                            <option value="O+">O+</option>
                                            <option value="O-">O-</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label for="allergies" class="form-label">Allergies</label>
                                        <textarea class="form-control" id="allergies" name="allergies" rows="2" placeholder="List any known allergies..."></textarea>
                                    </div>
                                    <div class="mb-3">
                                        <label for="medications" class="form-label">Current Medications</label>
                                        <textarea class="form-control" id="medications" name="medications" rows="2" placeholder="List current medications..."></textarea>
                                    </div>
                                    <div class="mb-3">
                                        <label for="medical_conditions" class="form-label">Medical Conditions</label>
                                        <textarea class="form-control" id="medical_conditions" name="medical_conditions" rows="2" placeholder="List any medical conditions..."></textarea>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <h6 class="mb-3">Injury History</h6>
                                    <div class="mb-3">
                                        <label for="injury_history" class="form-label">Previous Injuries</label>
                                        <textarea class="form-control" id="injury_history" name="injury_history" rows="4" placeholder="Describe any previous injuries..."></textarea>
                                    </div>
                                    <div class="mb-3">
                                        <label for="fitness_level" class="form-label">Current Fitness Level</label>
                                        <select class="form-select" id="fitness_level" name="fitness_level">
                                            <option value="">Select</option>
                                            <option value="excellent">Excellent</option>
                                            <option value="good">Good</option>
                                            <option value="average">Average</option>
                                            <option value="poor">Poor</option>
                                            <option value="recovering">Recovering</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label for="last_medical_check" class="form-label">Last Medical Check</label>
                                        <input type="date" class="form-control" id="last_medical_check" name="last_medical_check">
                                    </div>
                                    <div class="mb-3">
                                        <label for="medical_notes" class="form-label">Medical Notes</label>
                                        <textarea class="form-control" id="medical_notes" name="medical_notes" rows="3" placeholder="Additional medical notes..."></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Documents Tab -->
                        <div class="tab-pane fade" id="documents" role="tabpanel">
                            <div class="row">
                                <div class="col-md-6">
                                    <h6 class="mb-3">Identity Documents</h6>
                                    <div class="mb-3">
                                        <label for="passport_number" class="form-label">Passport Number</label>
                                        <input type="text" class="form-control" id="passport_number" name="passport_number">
                                    </div>
                                    <div class="mb-3">
                                        <label for="passport_expiry" class="form-label">Passport Expiry</label>
                                        <input type="date" class="form-control" id="passport_expiry" name="passport_expiry">
                                    </div>
                                    <div class="mb-3">
                                        <label for="id_number" class="form-label">National ID Number</label>
                                        <input type="text" class="form-control" id="id_number" name="id_number">
                                    </div>
                                    <div class="mb-3">
                                        <label for="work_permit" class="form-label">Work Permit Status</label>
                                        <select class="form-select" id="work_permit" name="work_permit">
                                            <option value="">Not Required</option>
                                            <option value="valid">Valid</option>
                                            <option value="pending">Pending</option>
                                            <option value="expired">Expired</option>
                                            <option value="denied">Denied</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <h6 class="mb-3">File Uploads</h6>
                                    <div class="mb-3">
                                        <label for="passport_file" class="form-label">Passport Scan</label>
                                        <input type="file" class="form-control" id="passport_file" name="passport_file" accept=".pdf,.jpg,.png">
                                    </div>
                                    <div class="mb-3">
                                        <label for="id_file" class="form-label">ID Document</label>
                                        <input type="file" class="form-control" id="id_file" name="id_file" accept=".pdf,.jpg,.png">
                                    </div>
                                    <div class="mb-3">
                                        <label for="contract_file" class="form-label">Contract Document</label>
                                        <input type="file" class="form-control" id="contract_file" name="contract_file" accept=".pdf">
                                    </div>
                                    <div class="mb-3">
                                        <label for="medical_file" class="form-label">Medical Certificate</label>
                                        <input type="file" class="form-control" id="medical_file" name="medical_file" accept=".pdf,.jpg,.png">
                                    </div>
                                    <div class="mb-3">
                                        <label for="additional_documents" class="form-label">Additional Documents</label>
                                        <textarea class="form-control" id="additional_documents" name="additional_documents" rows="3" placeholder="List any additional documents on file..."></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" name="submit" class="btn btn-primary" id="submitPlayerBtn">
                        <i class="ph ph-plus"></i> Add Player
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Player Profile Modal -->
<div class="modal fade" id="playerProfileModal" tabindex="-1" aria-labelledby="playerProfileModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="playerProfileModalLabel">Player Profile</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="playerProfileContent">
                <!-- Content loaded dynamically -->
            </div>
        </div>
    </div>
</div>

<!-- Import Players Modal -->
<div class="modal fade" id="importPlayersModal" tabindex="-1" aria-labelledby="importPlayersModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form method="POST" action="{{ url_for('admin.import_players') }}" enctype="multipart/form-data">
                <div class="modal-header">
                    <h5 class="modal-title" id="importPlayersModalLabel">Import Players from Excel</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-info">
                        <i class="ph ph-info me-2"></i>
                        <strong>Import Requirements:</strong>
                        <ul class="mb-0 mt-2">
                            <li>File must be in Excel format (.xlsx or .xls)</li>
                            <li>Required column: "Name"</li>
                            <li>Optional columns: Email, Phone, Date of Birth, Position, Jersey Number, Emergency Contact Name, Emergency Contact Phone, Team</li>
                            <li>Date format: YYYY-MM-DD (e.g., 1995-05-15)</li>
                            <li>Team column should match existing team names</li>
                        </ul>
                    </div>

                    <div class="mb-3">
                        <label for="excel_file" class="form-label">Choose Excel File</label>
                        <input type="file" class="form-control" id="excel_file" name="excel_file" accept=".xlsx,.xls" required>
                    </div>

                    <div class="mb-3">
                        <a href="{{ url_for('admin.export_players') }}" class="btn btn-sm btn-outline-info">
                            <i class="ph ph-download me-1"></i>Download Template (Export Current Data)
                        </a>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="ph ph-upload me-2"></i>Import Players
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Delete Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form id="deleteForm" method="POST" action="{{ url_for('admin.manage_players') }}">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteModalLabel">Confirm Delete</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-warning">
                        <i class="ph ph-warning"></i>
                        Are you sure you want to delete this player? This action cannot be undone.
                    </div>
                    <input type="hidden" id="deleteItemId" name="deleteEntityId">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" name="delete" class="btn btn-danger">
                        <i class="ph ph-trash"></i> Delete Player
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    // Global variables
    let currentView = 'table';
    let selectedPlayers = [];

    // Initialize page
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize photo upload preview
        document.getElementById('player_photo').addEventListener('change', handlePhotoUpload);

        // Initialize select all functionality
        document.getElementById('selectAll').addEventListener('change', toggleSelectAll);
        document.getElementById('tableSelectAll').addEventListener('change', toggleSelectAll);

        // Initialize player checkboxes
        document.querySelectorAll('.player-checkbox').forEach(checkbox => {
            checkbox.addEventListener('change', updateSelectedPlayers);
        });
    });

    // Photo upload handler
    function handlePhotoUpload(event) {
        const file = event.target.files[0];
        const preview = document.getElementById('photoPreview');

        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                preview.innerHTML = `<img src="${e.target.result}" alt="Preview" style="width: 100%; height: 150px; object-fit: cover; border-radius: 8px;">`;
            };
            reader.readAsDataURL(file);
        }
    }

    // View toggle functions
    function toggleView(view) {
        currentView = view;

        // Hide all views
        document.getElementById('tableView').style.display = 'none';
        document.getElementById('cardsView').style.display = 'none';
        document.getElementById('listView').style.display = 'none';

        // Remove active class from all buttons
        document.getElementById('tableViewBtn').classList.remove('active');
        document.getElementById('cardViewBtn').classList.remove('active');
        document.getElementById('listViewBtn').classList.remove('active');

        // Show selected view and activate button
        if (view === 'table') {
            document.getElementById('tableView').style.display = 'block';
            document.getElementById('tableViewBtn').classList.add('active');
        } else if (view === 'cards') {
            document.getElementById('cardsView').style.display = 'block';
            document.getElementById('cardViewBtn').classList.add('active');
        } else if (view === 'list') {
            document.getElementById('listView').style.display = 'block';
            document.getElementById('listViewBtn').classList.add('active');
        }
    }

    // Filter players function
    function filterPlayers() {
        const filters = {
            search: document.getElementById('filter-search').value.toLowerCase(),
            team: document.getElementById('filter-team').value.toLowerCase(),
            position: document.getElementById('filter-position').value.toLowerCase(),
            status: document.getElementById('filter-status').value.toLowerCase(),
            age: document.getElementById('filter-age').value,
            nationality: document.getElementById('filter-nationality').value.toLowerCase(),
            contract: document.getElementById('filter-contract').value.toLowerCase(),
            registration: document.getElementById('filter-registration').value.toLowerCase(),
            created: document.getElementById('filter-created').value.toLowerCase()
        };

        const playerElements = document.querySelectorAll('.player-row, .player-card, .player-list-item');
        let visibleCount = 0;

        playerElements.forEach(element => {
            const elementData = {
                team: element.dataset.team.toLowerCase(),
                position: element.dataset.position.toLowerCase(),
                status: element.dataset.status.toLowerCase(),
                nationality: element.dataset.nationality.toLowerCase(),
                playerData: element.dataset.playerData.toLowerCase()
            };

            let visible = true;

            // Apply filters
            if (filters.search && !elementData.playerData.includes(filters.search)) visible = false;
            if (filters.team && !elementData.team.includes(filters.team)) visible = false;
            if (filters.position && elementData.position !== filters.position) visible = false;
            if (filters.status && elementData.status !== filters.status) visible = false;
            if (filters.nationality && !elementData.nationality.includes(filters.nationality)) visible = false;

            // Age filter (would need age calculation in real implementation)
            if (filters.age) {
                // This would need proper age calculation based on date of birth
                // For now, we'll skip this filter
            }

            element.style.display = visible ? '' : 'none';
            if (visible) visibleCount++;
        });

        // Update player count
        document.getElementById('playerCount').textContent = visibleCount;
    }

    // Clear all filters
    function clearAllFilters() {
        document.getElementById('filter-search').value = '';
        document.getElementById('filter-team').value = '';
        document.getElementById('filter-position').value = '';
        document.getElementById('filter-status').value = '';
        document.getElementById('filter-age').value = '';
        document.getElementById('filter-nationality').value = '';
        document.getElementById('filter-contract').value = '';
        document.getElementById('filter-registration').value = '';
        document.getElementById('filter-created').value = '';
        filterPlayers();
    }

    // Player selection functions
    function toggleSelectAll() {
        const selectAllChecked = document.getElementById('selectAll').checked || document.getElementById('tableSelectAll').checked;
        const checkboxes = document.querySelectorAll('.player-checkbox');

        checkboxes.forEach(checkbox => {
            checkbox.checked = selectAllChecked;
        });

        updateSelectedPlayers();
    }

    function updateSelectedPlayers() {
        selectedPlayers = Array.from(document.querySelectorAll('.player-checkbox:checked')).map(cb => cb.value);

        const bulkActions = document.getElementById('bulkActions');
        if (selectedPlayers.length > 0) {
            bulkActions.style.display = 'block';
        } else {
            bulkActions.style.display = 'none';
        }
    }

    // Player CRUD functions
    function editPlayer(playerId, teamId, name, position, dateOfBirth, nationality, email, weight, height, sport) {
        // Populate form with player data
        document.getElementById('player_id').value = playerId;
        document.getElementById('team_id').value = teamId;
        document.getElementById('name').value = name;
        document.getElementById('date_of_birth').value = dateOfBirth;
        document.getElementById('nationality').value = nationality;
        document.getElementById('email').value = email || '';
        document.getElementById('weight_kg').value = weight || '';
        document.getElementById('height_cm').value = height || '';
        document.getElementById('sport').value = sport || 'Football';

        // Update positions based on sport
        updatePositions();
        // Set the position after positions are updated
        setTimeout(() => {
            document.getElementById('position').value = position;
        }, 100);

        document.getElementById('addPlayerModalLabel').textContent = 'Edit Player';
        document.getElementById('submitPlayerBtn').innerHTML = '<i class="ph ph-check"></i> Update Player';

        const modal = new bootstrap.Modal(document.getElementById('addPlayerModal'));
        modal.show();
    }

    function viewPlayerProfile(playerId) {
        const modal = new bootstrap.Modal(document.getElementById('playerProfileModal'));
        const content = document.getElementById('playerProfileContent');

        // Show loading
        content.innerHTML = `
            <div class="text-center py-4">
                <div class="spinner-border" role="status"></div>
                <p class="mt-2">Loading player profile...</p>
            </div>
        `;

        modal.show();

        // Simulate loading player profile
        setTimeout(() => {
            content.innerHTML = `
                <div class="alert alert-info">
                    <i class="ph ph-info"></i>
                    Player profile details would be loaded here. Implement backend endpoint to fetch full player profile.
                </div>
            `;
        }, 1000);
    }

    function contactPlayer(playerId) {
        // Open contact modal or redirect to communication interface
        alert('Contact player functionality - would open communication interface');
    }

    // Bulk operations
    function bulkStatusUpdate(status) {
        if (selectedPlayers.length === 0) {
            alert('Please select players first');
            return;
        }

        if (confirm(`Update status to "${status}" for ${selectedPlayers.length} players?`)) {
            // Implement bulk status update
            console.log('Bulk status update:', status, selectedPlayers);
        }
    }

    function bulkExport() {
        if (selectedPlayers.length === 0) {
            alert('Please select players first');
            return;
        }

        // Implement bulk export
        console.log('Bulk export:', selectedPlayers);
    }

    function bulkDelete() {
        if (selectedPlayers.length === 0) {
            alert('Please select players first');
            return;
        }

        if (confirm(`Delete ${selectedPlayers.length} players? This action cannot be undone.`)) {
            // Implement bulk delete
            console.log('Bulk delete:', selectedPlayers);
        }
    }

    // Export functions
    function exportPlayers() {
        // Implement export functionality
        window.open('/admin/export-players', '_blank');
    }

    function processImport() {
        const fileInput = document.getElementById('importFile');
        const file = fileInput.files[0];

        if (!file) {
            alert('Please select a CSV file');
            return;
        }

        // Implement CSV import processing
        console.log('Processing import:', file.name);

        // Close modal
        bootstrap.Modal.getInstance(document.getElementById('importModal')).hide();
    }

    // Delete modal handler
    document.getElementById('deleteModal').addEventListener('show.bs.modal', function (event) {
        const button = event.relatedTarget;
        const id = button.getAttribute('data-id');
        document.getElementById('deleteItemId').value = id;
    });

    // Reset modal when opening for new player
    document.getElementById('addPlayerModal').addEventListener('show.bs.modal', function(event) {
        if (!event.relatedTarget || !event.relatedTarget.onclick) {
            // Reset form for new player
            document.getElementById('player_id').value = '';
            document.getElementById('addPlayerModalLabel').textContent = 'Add New Player';
            document.getElementById('submitPlayerBtn').innerHTML = '<i class="ph ph-plus"></i> Add Player';
            this.querySelector('form').reset();
            document.getElementById('photoPreview').innerHTML = '<i class="ph ph-camera"></i><p>Upload Photo</p>';
        }
    });

    // Sport-specific position logic
    const sportsPositions = {
        {% for sport_data in sports %}
        '{{ sport_data[0] }}': {{ sport_data[1] | tojson }},
        {% endfor %}
    };

    function updatePositions() {
        const sportSelect = document.getElementById('sport');
        const positionSelect = document.getElementById('position');
        const selectedSport = sportSelect.value;

        // Clear existing options
        positionSelect.innerHTML = '<option value="">Select Position</option>';

        // Add positions for selected sport
        if (selectedSport && sportsPositions[selectedSport]) {
            sportsPositions[selectedSport].forEach(position => {
                const option = document.createElement('option');
                option.value = position;
                option.textContent = position;
                positionSelect.appendChild(option);
            });
        }
    }

    // Update positions when sport changes
    document.getElementById('sport').addEventListener('change', updatePositions);

    // Initialize positions on page load
    document.addEventListener('DOMContentLoaded', updatePositions);
</script>
{% endblock %}
