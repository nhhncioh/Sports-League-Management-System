<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{{ g.org.name if g.org else 'Sports League' }}{% endblock %}</title>
    {% set theme = site_theme or {} %}
    {% set palette = theme.get('palette', {}) %}
    {% set typography = theme.get('typography', {}) %}
    {% set iconography = theme.get('iconography', {}) %}
    {% set components = theme.get('components', {}) %}
    {% set feature_flags = site_feature_flags or {} %}
    {% set gradient_start = palette.gradient_start or palette.primary or '#343a40' %}
    {% set gradient_end = palette.gradient_end or palette.accent or '#f97316' %}
    {% set nav_style = components.nav_style or 'glass' %}
    {% set nav_background = palette.nav_background or palette.primary or '#343a40' %}
    {% if nav_style in ['gradient', 'glass'] %}
        {% set nav_background_css = 'linear-gradient(135deg, ' ~ gradient_start ~ ', ' ~ gradient_end ~ ')' %}
    {% elif nav_style == 'minimal' %}
        {% set nav_background_css = 'transparent' %}
    {% else %}
        {% set nav_background_css = nav_background %}
    {% endif %}
    {% set radius_map = {'xs': '0.35rem','sm': '0.5rem','md': '0.75rem','lg': '1rem','xl': '1.5rem'} %}
    {% set button_shape_map = {'rounded': '0.75rem','soft': '0.5rem','pill': '999px','square': '0'} %}
    {% set card_shadow_map = {
        'none': 'none',
        'light': '0 6px 18px ' ~ (palette.shadow or 'rgba(15, 23, 42, 0.08)'),
        'medium': '0 12px 30px ' ~ (palette.shadow or 'rgba(15, 23, 42, 0.12)'),
        'heavy': '0 20px 48px ' ~ (palette.shadow or 'rgba(15, 23, 42, 0.2)')
    } %}
    {% set button_glow_shadow = '0 0 24px ' ~ (palette.accent or '#f97316') if components.button_glow else 'none' %}
    {% set layout_density_map = {'compact': '0.9','comfortable': '1','spacious': '1.12'} %}
    {% set density_scale = layout_density_map.get(components.layout_density or 'comfortable', '1') %}
    {% set surface_tint = components.surface_tint or 'subtle' %}
    {% set button_style = components.button_style or 'solid' %}
    {% set button_primary = palette.primary or '#343a40' %}
    {% set gradient_css = 'linear-gradient(135deg, ' ~ gradient_start ~ ', ' ~ gradient_end ~ ')' %}
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@200;300;400;500;600;700;800&family=Poppins:wght@300;400;500;600;700&family=Montserrat:wght@300;400;500;600;700&family=Roboto:wght@300;400;500;700&family=Nunito:wght@300;400;600;700;800&family=Raleway:wght@200;300;400;500;600;700&family=Work+Sans:wght@300;400;500;600;700&family=Source+Sans+Pro:wght@300;400;600;700&family=IBM+Plex+Sans:wght@300;400;500;600;700&family=Fira+Sans:wght@300;400;500;600;700&family=Space+Grotesk:wght@300;400;500;600;700&family=Roboto+Slab:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&family=Merriweather:wght@300;400;700&family=Lora:wght@400;500;600;700&family=Abril+Fatface&family=IBM+Plex+Serif:wght@300;400;500;600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link id="app-stylesheet" rel="stylesheet" href="{{ url_for('static', filename='css/app.css') }}">
    {% block extra_css %}{% endblock %}
    {% if favicon_url %}
    <link rel="icon" href="{{ favicon_url }}" type="image/png">
    {% endif %}
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.2/src/thin/style.css?v=2">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.2/src/light/style.css?v=2">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.2/src/regular/style.css?v=2">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.2/src/bold/style.css?v=2">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.2/src/fill/style.css?v=2">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.2/src/duotone/style.css?v=2">
    <style>
    :root {
        --slms-primary: {{ palette.primary or '#343a40' }};
        --slms-secondary: {{ palette.secondary or '#6c757d' }};
        --slms-accent: {{ palette.accent or '#f97316' }};
        --slms-background: {{ palette.background or '#f5f6fa' }};
        --slms-surface: {{ palette.surface or '#ffffff' }};
        --slms-text: {{ palette.text or '#1f2937' }};
        --slms-muted: {{ palette.muted or '#6b7280' }};
        --slms-heading: {{ palette.heading or '#111827' }};
        --slms-card-border: {{ palette.card_border or 'rgba(15, 23, 42, 0.08)' }};
        --slms-highlight: {{ palette.highlight or '#fde68a' }};
        --slms-gradient-start: {{ gradient_start }};
        --slms-gradient-end: {{ gradient_end }};
        --slms-shadow-color: {{ palette.shadow or 'rgba(15, 23, 42, 0.12)' }};
        --slms-font-base: {{ typography.base_family or 'Inter, system-ui, sans-serif' }};
        --slms-font-heading: {{ typography.heading_family or typography.base_family or 'Inter, system-ui, sans-serif' }};
        --slms-font-size-base: {{ typography.base_size or '16px' }};
        --slms-line-height: {{ typography.line_height or 1.6 }};
        --slms-heading-line-height: {{ typography.heading_line_height or 1.3 }};
        --slms-letter-spacing: {{ typography.letter_spacing or 'normal' }};
        --slms-heading-letter-spacing: {{ typography.heading_letter_spacing or '0.01em' }};
        --slms-heading-transform: {{ typography.heading_transform or 'none' }};
        --slms-body-weight: {{ typography.base_weight or '400' }};
        --slms-heading-weight: {{ typography.heading_weight or '600' }};
        --slms-button-radius: {{ button_shape_map.get(components.button_shape or 'rounded', '0.75rem') }};
        --slms-card-radius: {{ radius_map.get(components.border_radius_scale or 'md', '0.75rem') }};
        --slms-card-shadow: {{ card_shadow_map.get(components.card_shadow or 'medium') }};
        --slms-button-shadow: {{ button_glow_shadow }};
        --slms-button-bg: {{ button_primary }};
        --slms-button-border: {{ button_primary }};
        --slms-button-color: #fff;
        --slms-button-hover-bg: {{ button_primary }};
        --slms-button-hover-border: {{ button_primary }};
        --slms-button-hover-color: #fff;
        --slms-button-outline-color: {{ button_primary }};
        --slms-button-outline-hover-bg: {{ button_primary }};
        --slms-button-outline-hover-color: #fff;
        --slms-layout-density: {{ density_scale }};
        --slms-icon-base: {{ iconography.primary_color or 'currentColor' }};
        --slms-icon-hover: {{ iconography.hover_color or palette.accent or '#f97316' }};
        --slms-navbar-opacity: {{ components.navbar_transparency or 0.9 }};
        --slms-navbar-blur: {{ components.navbar_blur or '18px' }};
        --app-navbar-background: {{ nav_background_css }};
        --app-navbar-text: {{ palette.nav_text or '#ffffff' }};
        --app-navbar-hover: {{ palette.nav_hover or '#ffffff' }};
        --app-navbar-shadow: {{ palette.shadow or 'rgba(15, 23, 42, 0.12)' }};
    }

    body {
        font-family: var(--slms-font-base);
        font-size: var(--slms-font-size-base);
        line-height: var(--slms-line-height);
        color: {{ palette.text or '#1f2937' }};
        background: {{ palette.background or '#f5f6fa' }};
    }
    h1, h2, h3, h4, h5, h6 {
        font-family: var(--slms-font-heading);
        font-weight: var(--slms-heading-weight);
        letter-spacing: var(--slms-heading-letter-spacing);
        text-transform: var(--slms-heading-transform);
        line-height: var(--slms-heading-line-height);
        color: {{ palette.heading or '#111827' }};
    }
    .theme-icon {
        color: var(--slms-icon-base);
        transition: color 0.2s ease;
    }
    .theme-icon:hover {
        color: var(--slms-icon-hover);
    }
    .navbar.app-navbar {
        margin: 0;
        border-radius: 0;
        padding-block: 0.75rem;
        background: var(--app-navbar-background);
        color: var(--app-navbar-text);
        backdrop-filter: {% if nav_style in ['glass', 'gradient'] %}blur(var(--slms-navbar-blur)){% else %}none{% endif %};
        box-shadow: 0 12px 30px var(--app-navbar-shadow);
        opacity: var(--slms-navbar-opacity);
        border-bottom: {% if nav_style == 'minimal' %}1px solid rgba(15, 23, 42, 0.08){% else %}none{% endif %};
    }
    body.nav-style-minimal .navbar.app-navbar {
        background: var(--slms-surface);
        box-shadow: none;
        border-bottom: 1px solid rgba(15, 23, 42, 0.08);
    }
    .navbar.app-navbar .nav-link {
        color: var(--app-navbar-text) !important;
        border-radius: 999px;
        transition: background 0.2s ease, color 0.2s ease;
    }
    .navbar.app-navbar .nav-link:hover,
    .navbar.app-navbar .nav-link:focus,
    .navbar.app-navbar .nav-link.active {
        color: var(--app-navbar-hover) !important;
        background: rgba(255, 255, 255, 0.12);
    }
    .btn-primary {
        background: var(--slms-button-bg);
        border-color: var(--slms-button-border);
        color: var(--slms-button-color);
        border-radius: var(--slms-button-radius);
        box-shadow: var(--slms-button-shadow);
        transition: background 0.2s ease, color 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease;
    }
    .btn-primary:hover,
    .btn-primary:focus {
        background: var(--slms-button-hover-bg);
        border-color: var(--slms-button-hover-border);
        color: var(--slms-button-hover-color);
        box-shadow: var(--slms-button-shadow);
    }
    .btn-outline-primary {
        color: var(--slms-button-outline-color);
        border-color: var(--slms-button-outline-color);
        border-radius: var(--slms-button-radius);
        transition: background 0.2s ease, color 0.2s ease, border-color 0.2s ease;
    }
    .btn-outline-primary:hover,
    .btn-outline-primary:focus {
        background: var(--slms-button-outline-hover-bg);
        color: var(--slms-button-outline-hover-color);
        border-color: var(--slms-button-outline-color);
    }
    body.button-style-outline {
        --slms-button-bg: transparent;
        --slms-button-border: {{ button_primary }};
        --slms-button-color: {{ button_primary }};
        --slms-button-hover-bg: {{ button_primary }};
        --slms-button-hover-border: {{ button_primary }};
        --slms-button-hover-color: #fff;
        --slms-button-outline-color: {{ button_primary }};
        --slms-button-outline-hover-bg: {{ button_primary }};
        --slms-button-outline-hover-color: #fff;
    }
    body.button-style-gradient {
        --slms-button-bg: {{ gradient_css }};
        --slms-button-border: transparent;
        --slms-button-color: #fff;
        --slms-button-hover-bg: linear-gradient(135deg, {{ gradient_end }}, {{ gradient_start }});
        --slms-button-hover-border: transparent;
        --slms-button-hover-color: #fff;
    }
    body.button-style-ghost {
        --slms-button-bg: transparent;
        --slms-button-border: transparent;
        --slms-button-color: {{ button_primary }};
        --slms-button-hover-bg: {% if button_primary|first == '#' %}{{ button_primary ~ '14' }}{% else %}rgba(15, 23, 42, 0.1){% endif %};
        --slms-button-hover-border: transparent;
        --slms-button-hover-color: {{ button_primary }};
        --slms-button-outline-color: {{ button_primary }};
        --slms-button-outline-hover-bg: {% if button_primary|first == '#' %}{{ button_primary ~ '14' }}{% else %}rgba(15, 23, 42, 0.1){% endif %};
        --slms-button-outline-hover-color: {{ button_primary }};
        --slms-button-shadow: none;
    }
    body.theme-gradients.button-style-solid {
        --slms-button-bg: {{ gradient_css }};
        --slms-button-border: transparent;
        --slms-button-hover-bg: linear-gradient(135deg, {{ gradient_end }}, {{ gradient_start }});
        --slms-button-hover-border: transparent;
    }
    body .btn,
    body .btn-primary,
    body .btn-outline-primary,
    body .btn-outline-secondary,
    body .btn-light,
    body .btn-lg,
    body .btn-sm {
        border-radius: var(--slms-button-radius) !important;
    }
    .card {
        border-radius: var(--slms-card-radius);
        border: 1px solid var(--slms-card-border);
        box-shadow: var(--slms-card-shadow);
        background: {% if surface_tint == 'solid' %}{{ palette.surface or '#ffffff' }}{% elif surface_tint == 'frosted' %}rgba(255, 255, 255, 0.82){% elif surface_tint == 'none' %}transparent{% else %}linear-gradient(180deg, rgba(255, 255, 255, 0.92), rgba(255, 255, 255, 0.86)){% endif %};
        backdrop-filter: {% if surface_tint == 'frosted' %}blur(12px){% else %}none{% endif %};
    }
    .badge.bg-primary-subtle {
        background: {{ (palette.primary or '#343a40') ~ '1a' }};
        color: {{ palette.primary or '#343a40' }};
    }
    .badge.bg-warning-subtle {
        background: {{ (palette.warning or '#ffc107') ~ '1a' }};
        color: {{ palette.warning or '#ffc107' }};
    }
    .badge.bg-danger-subtle {
        background: {{ (palette.danger or '#dc3545') ~ '1a' }};
        color: {{ palette.danger or '#dc3545' }};
    }
    .sidebar-panel {
        background: {{ nav_background }};
        color: {{ palette.nav_text or '#ffffff' }};
    }
    .sidebar-panel .sidebar-link {
        color: rgba(255, 255, 255, 0.88);
    }
    .sidebar-panel .sidebar-link:hover,
    .sidebar-panel .sidebar-link:focus {
        color: #fff;
        background: rgba(255, 255, 255, 0.12);
    }
    .density-compact .container,
    .density-compact .main-content,
    .density-comfortable .container,
    .density-comfortable .main-content,
    .density-spacious .container,
    .density-spacious .main-content {
        --container-padding-y: calc(2rem * {{ density_scale }});
    }
    </style>
    {% if site_theme.custom_css %}
    <style id="site-inline-custom">{{ site_theme.custom_css }}</style>
    {% endif %}
<!-- injected: admin css + fallbacks -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/admin-fallback.css') }}" media="print" onload="this.media='all'">

<script>
(function(){
  try{
    var main = document.getElementById('app-stylesheet');
    var ensureFallback = function(link){
      if(!link) { return; }
      link.addEventListener('error', function(){
        var s = document.createElement('script');
        s.src = 'https://cdn.tailwindcss.com';
        document.head.appendChild(s);
      }, { once: true });
    };
    if(!main){
      main = document.createElement('link');
      main.id = 'app-stylesheet';
      main.rel = 'stylesheet';
      main.href = '{{ url_for("static", filename="css/app.css") }}';
      ensureFallback(main);
      document.head.appendChild(main);
    } else {
      ensureFallback(main);
    }
  }catch(e){}
})();
</script>

<!-- /injected -->
</head>
{% set nav_layout = nav_layout|default('top') %}
{% set nav_links = navigation_links|default([]) %}
{% set is_authenticated = current_user.is_authenticated %}
{% set has_role_fn = current_user.has_role if is_authenticated and current_user.has_role is not none else None %}
{% set user_is_admin = has_role_fn('ADMIN', 'OWNER') if has_role_fn is not none else False %}
{% macro themed_icon(name, extra_classes='') -%}
    <i class="{{ site_icon_class }} {{ name }} {{ extra_classes }}"></i>
{%- endmacro %}
{% macro render_nav_items(items, item_class='nav-item', link_class='nav-link', icon_gap='me-1') -%}
    {%- for item in items %}
        {%- set audience = item.audience or 'everyone' %}
        {%- if audience == 'everyone'
              or (audience == 'auth' and is_authenticated)
              or (audience == 'guest' and not is_authenticated)
              or (audience == 'admin' and user_is_admin) %}
            <li class="{{ item_class }}">
                <a class="{{ link_class }}{% if item.broken %} disabled{% endif %}" href="{{ item.href if not item.broken else '#' }}" {% if item.open_in_new %}target="_blank" rel="noopener"{% endif %}>
                    {% if item.icon %}{% set icon_name = item.icon.split(' ')|last %}{{ themed_icon(icon_name, icon_gap ~ ' theme-icon') }}{% endif %}
                    {{ item.label }}
                    {% if item.broken %}<span class="visually-hidden">(link unavailable)</span>{% endif %}
                </a>
            </li>
        {%- endif %}
    {%- endfor %}
{%- endmacro %}
{% macro render_flash_messages() -%}
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="flash-stack mb-4">
                {% for category, message in messages %}
                    <div class="alert alert-modern alert-{{ 'danger' if category == 'error' else category }} d-flex align-items-center" role="alert">
                        <div class="flex-grow-1">{{ message }}</div>
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}
{%- endmacro %}
{% set body_content %}
    {% block content %}{% endblock %}
{% endset %}
{% macro render_global_footer(footer, ctas, feature_flags, social_links, social_labels, brand_name, fallback_tagline) %}
    {% set footer = footer or {} %}
    {% set columns = footer.get('columns') if footer else [] %}
    {% set tagline = footer.get('tagline') if footer else '' %}
    {% if not tagline and fallback_tagline %}
        {% set tagline = fallback_tagline %}
    {% endif %}
    {% set legal_text = footer.get('legal') if footer else '' %}
    {% if not legal_text %}
        {% set legal_text = '? ' ~ brand_name %}
    {% endif %}
    {% set show_social = footer.get('show_social') if footer else None %}
    {% if show_social is none %}
        {% set show_social = feature_flags.get('show_footer_social', True) %}
    {% endif %}
    {% set cta_primary = ctas.get('footer_primary', {}) %}
    {% set cta_secondary = ctas.get('footer_secondary', {}) %}
    {% set cta_class_map = {
        'primary': 'btn btn-lg btn-primary shadow-sm',
        'secondary': 'btn btn-lg btn-secondary shadow-sm',
        'outline': 'btn btn-lg btn-outline-light',
        'ghost': 'btn btn-lg btn-outline-light opacity-75',
        'link': 'btn btn-lg btn-link text-white'
    } %}
    {% set social_icon_map = {
        'facebook': 'ph ph-facebook-logo',
        'instagram': 'ph ph-instagram-logo',
        'twitter': 'ph ph-x-logo',
        'x': 'ph ph-x-logo',
        'youtube': 'ph ph-youtube-logo',
        'tiktok': 'ph ph-tiktok-logo',
        'linkedin': 'ph ph-linkedin-logo',
        'twitch': 'ph ph-twitch-logo',
        'custom_1': 'ph ph-link',
        'custom_2': 'ph ph-link'
    } %}
    <div class="footer-shell">
        <div class="footer-top">
            <div class="footer-brand">
                <div class="footer-brand-title">
                    <span class="badge text-bg-light text-dark">League</span>
                    <span>{{ brand_name }}</span>
                </div>
                {% if tagline %}
                    <p class="footer-tagline">{{ tagline }}</p>
                {% endif %}
            </div>
            <div class="footer-actions">
                {% if cta_primary.enabled %}
                    <a class="{{ cta_class_map.get(cta_primary.style, cta_class_map['primary']) }}" href="{{ cta_primary.url }}" {% if cta_primary.new_tab %}target="_blank" rel="noopener"{% endif %}>
                        {% if cta_primary.icon %}<i class="{{ cta_primary.icon }} me-2"></i>{% endif %}
                        {{ cta_primary.label }}
                    </a>
                {% endif %}
                {% if cta_secondary.enabled %}
                    <a class="{{ cta_class_map.get(cta_secondary.style, cta_class_map['outline']) }}" href="{{ cta_secondary.url }}" {% if cta_secondary.new_tab %}target="_blank" rel="noopener"{% endif %}>
                        {% if cta_secondary.icon %}<i class="{{ cta_secondary.icon }} me-2"></i>{% endif %}
                        {{ cta_secondary.label }}
                    </a>
                {% endif %}
                {% if not cta_primary.enabled and not cta_secondary.enabled %}
                    <a class="{{ cta_class_map['primary'] }}" href="{{ url_for('portal.index') }}">Go to Portal</a>
                {% endif %}
            </div>
        </div>
        {% if columns %}
            <div class="footer-columns">
                {% for column in columns %}
                    {% if column.links %}
                        <div class="footer-column">
                            <div class="footer-column-title">{{ column.title }}</div>
                            <ul class="footer-link-list">
                                {% for link in column.links %}
                                    <li>
                                        <a class="footer-link" href="{{ link.url }}" {% if link.open_in_new %}target="_blank" rel="noopener"{% endif %}>
                                            {% if link.icon %}<i class="{{ link.icon }}"></i>{% endif %}
                                            <span>{{ link.label }}</span>
                                        </a>
                                    </li>
                                {% endfor %}
                            </ul>
                        </div>
                    {% endif %}
                {% endfor %}
            </div>
        {% endif %}
        <div class="footer-meta">
            <div class="footer-legal">{{ legal_text }}</div>
            {% if show_social and social_links %}
                <div class="footer-social">
                    {% set labels = social_labels or {} %}
                    {% for key, url in social_links.items() %}
                        {% if url %}
                            {% set icon = social_icon_map.get(key, 'ph ph-globe') %}
                            {% set label = labels.get(key, key.replace('_', ' ').title()) %}
                            <a href="{{ url }}" target="_blank" rel="noopener" aria-label="{{ label }}">
                                <i class="{{ icon }}"></i>
                            </a>
                        {% endif %}
                    {% endfor %}
                </div>
            {% endif %}
        </div>
    </div>
{% endmacro %}

<body class="app-shell d-flex flex-column min-vh-100 bg-surface text-body{% if nav_layout == 'sidebar' %} layout-sidebar{% endif %}{% if components.use_gradients %} theme-gradients{% endif %} nav-style-{{ nav_style }} button-style-{{ button_style }} density-{{ components.layout_density or 'comfortable' }}{% if components.section_dividers %} has-section-dividers{% endif %}{% if feature_flags.enable_dark_mode %} has-dark-toggle{% endif %}">
    {% if nav_layout == 'sidebar' %}
    <div class="sidebar-wrapper d-flex flex-column flex-lg-row flex-grow-1">
        <aside class="sidebar-panel d-none d-lg-flex flex-column">
            <div class="sidebar-brand d-flex align-items-center gap-2 mb-4">
                <a class="text-white text-decoration-none d-flex align-items-center gap-2" href="{{ url_for('public.landing') }}">
                    {% if g.org and g.org.logo_url %}
                        <span class="brand-avatar" style="background-image: url('{{ g.org.logo_url }}');"></span>
                    {% else %}
                        <span class="brand-avatar placeholder">SL</span>
                    {% endif %}
                    <span class="fw-semibold">{{ g.org.name if g.org else site_title }}</span>
                </a>
            </div>
            <nav class="sidebar-menu flex-grow-1">
                <ul class="nav flex-column gap-1">
                    {{ render_nav_items(nav_links, item_class='nav-item', link_class='nav-link sidebar-link', icon_gap='me-3') }}
                </ul>
            </nav>
            <div class="sidebar-footer mt-4">
                {% if is_authenticated %}
                    <a class="nav-link sidebar-link" href="{{ url_for('public.profile') }}">{{ themed_icon('ph-user-circle', 'me-3') }}Profile</a>
                    {% if user_is_admin %}
                        <a class="nav-link sidebar-link" href="{{ url_for('admin.admin_dashboard', org=session.get('org_slug')) }}">{{ themed_icon('ph-speedometer', 'me-3') }}Admin Console</a>
                    {% endif %}
                    <a class="nav-link sidebar-link" href="{{ url_for('auth.logout') }}">{{ themed_icon('ph-sign-out', 'me-3') }}Logout</a>
                {% else %}
                    <a class="nav-link sidebar-link" href="{{ url_for('auth.login') }}">{{ themed_icon('ph-sign-in', 'me-3') }}Login</a>
                {% endif %}
            </div>
        </aside>
        <div class="sidebar-main flex-grow-1 d-flex flex-column">
            {% set nav_skin_mobile = 'navbar-dark' if nav_style != 'minimal' else 'navbar-light' %}
            <nav class="navbar navbar-expand-lg app-navbar d-lg-none {{ nav_skin_mobile }}">
                <div class="container">
                    <a class="navbar-brand d-flex align-items-center gap-2" href="{{ url_for('public.landing') }}">
                        {% if g.org and g.org.logo_url %}
                            <span class="brand-avatar" style="background-image: url('{{ g.org.logo_url }}');"></span>
                        {% else %}
                            <span class="brand-avatar placeholder">SL</span>
                        {% endif %}
                        <span class="fw-semibold">{{ g.org.name if g.org else site_title }}</span>
                    </a>
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mobileSidebarNav">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse" id="mobileSidebarNav">
                        <ul class="navbar-nav me-auto">
                            {{ render_nav_items(nav_links) }}
                        </ul>
                        <ul class="navbar-nav ms-auto">
                            {% if is_authenticated %}
                                <li class="nav-item"><a class="nav-link" href="{{ url_for('public.profile') }}">Profile</a></li>
                                {% if user_is_admin %}
                                    <li class="nav-item"><a class="nav-link" href="{{ url_for('admin.admin_dashboard', org=session.get('org_slug')) }}">Admin</a></li>
                                {% endif %}
                                <li class="nav-item"><a class="nav-link" href="{{ url_for('auth.logout') }}">Logout</a></li>
                            {% else %}
                                <li class="nav-item"><a class="nav-link" href="{{ url_for('auth.login') }}">Login</a></li>
                            {% endif %}
                        </ul>
                    </div>
                </div>
            </nav>
            <div class="main-content flex-grow-1">
                <div class="container py-5">
                    {{ render_flash_messages() }}
                    {{ body_content|safe }}
                </div>
            </div>
            <footer class="footer-modern mt-auto">
                <div class="container">
                    {{ render_global_footer(site_footer, site_cta_slots, feature_flags, (site_social_links or {}), theme.get('social_labels', {}), g.org.name if g.org else site_title, theme.get('hero_tagline') or theme.get('brand_message') or '') }}
                </div>
            </footer>
        </div>
    </div>
    {% else %}
    {% set nav_skin_main = 'navbar-dark' if nav_style != 'minimal' else 'navbar-light' %}
    <nav class="navbar navbar-expand-lg app-navbar {{ nav_skin_main }}">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center gap-2" href="{{ url_for('public.landing') }}">
                {% if g.org and g.org.logo_url %}
                    <span class="brand-avatar" style="background-image: url('{{ g.org.logo_url }}');"></span>
                {% else %}
                    <span class="brand-avatar placeholder">SL</span>
                {% endif %}
                <span class="fw-semibold">{{ g.org.name if g.org else site_title }}</span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto align-items-lg-center">
                    {{ render_nav_items(nav_links) }}
                </ul>
                <ul class="navbar-nav align-items-lg-center gap-lg-2">
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('public.search') }}" title="Search">
                            <i class="ph ph-magnifying-glass"></i>
                            <span class="d-lg-none ms-2">Search</span>
                        </a>
                    </li>
                    {% if is_authenticated %}
                        {% set avatar_text = current_user.email[:2]|upper %}
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle d-flex align-items-center gap-2" href="#" role="button" data-bs-toggle="dropdown">
                                <span class="avatar-sm text-uppercase">{{ avatar_text }}</span>
                                <span>{{ current_user.email }}</span>
                            </a>
                            <ul class="dropdown-menu dropdown-menu-end shadow-sm">
                                <li><a class="dropdown-item" href="{{ url_for('public.profile') }}">Profile</a></li>
                                {% if user_is_admin %}
                                    <li><a class="dropdown-item" href="{{ url_for('admin.admin_dashboard', org=session.get('org_slug')) }}">Admin Console</a></li>
                                {% endif %}
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="{{ url_for('auth.logout') }}">Logout</a></li>
                            </ul>
                        </li>
                    {% else %}
                        <li class="nav-item"><a class="nav-link" href="{{ url_for('auth.login') }}">Login</a></li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </nav>
    <div class="main-content flex-grow-1">
        <div class="container py-5">
            {{ render_flash_messages() }}
            {{ body_content|safe }}
        </div>
    </div>
    <footer class="footer-modern mt-auto">
        <div class="container">
            {{ render_global_footer(site_footer, site_cta_slots, feature_flags, (site_social_links or {}), theme.get('social_labels', {}), g.org.name if g.org else site_title, theme.get('hero_tagline') or theme.get('brand_message') or '') }}
        </div>
    </footer>
    {% endif %}

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/htmx.org@1.9.12"></script>

    <meta name="csrf-token" content="{{ csrf_token() }}">
    <script>
        window.csrfToken = document.querySelector('meta[name="csrf-token"]').getAttribute('content');
        function addCSRFToken(formData) {
            formData.append('csrf_token', window.csrfToken);
            return formData;
        }
        function getCSRFHeaders() {
            return { 'X-CSRFToken': window.csrfToken };
        }
        window.secureFetch = function(url, options = {}) {
            if (!options.headers) {
                options.headers = {};
            }
            if (!options.method || options.method.toUpperCase() !== 'GET') {
                Object.assign(options.headers, getCSRFHeaders());
            }
            return fetch(url, options);
        };
    </script>

    {% block extra_js %}{% endblock %}
</body>
</html>




















